{
  "createdAt": "2025-07-02T07:42:29.406Z",
  "updatedAt": "2025-07-02T10:23:44.889Z",
  "id": "QIStyvPkZx56D18R",
  "name": "Client Managment workflow",
  "active": false,
  "isArchived": false,
  "nodes": [
    {
      "parameters": {
        "formTitle": "Signup",
        "formFields": {
          "values": [
            {
              "fieldLabel": "Full Name"
            },
            {
              "fieldLabel": "Email"
            },
            {
              "fieldLabel": "Phone Number"
            },
            {
              "fieldLabel": "Address"
            },
            {
              "fieldLabel": "Business Type"
            },
            {
              "fieldLabel": "Filing status"
            },
            {
              "fieldLabel": "Tax Year"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.formTrigger",
      "typeVersion": 2.2,
      "position": [
        -140,
        -20
      ],
      "id": "05e8a176-0692-4018-a773-3596723dfe4e",
      "name": "On form submission",
      "webhookId": "94e199af-bf3c-4f91-8db2-86e2a659efba"
    },
    {
      "parameters": {
        "operation": "executeQuery",
        "query": "INSERT INTO clients (\n    full_name,\n    email,\n    phone,\n    address,\n    business_type,\n    filing_status,\n    tax_year_preferences\n)\nVALUES (\n    '{{ $('On form submission').item.json['Full Name'] }}',\n    '{{ $('On form submission').item.json.Email }}',\n    '{{ $('On form submission').item.json['Phone Number'] }}',\n    '{{ $('On form submission').item.json.Address }}',\n    '{{ $('On form submission').item.json['Business Type'] }}',\n    '{{ $('On form submission').item.json['Filing status'] }}',\n    '{{ $('On form submission').item.json['Tax Year'] }}'::jsonb\n)\nRETURNING id;\n",
        "options": {}
      },
      "type": "n8n-nodes-base.postgres",
      "typeVersion": 2.6,
      "position": [
        500,
        -40
      ],
      "id": "92e97350-2436-4767-b415-ff4ae3890792",
      "name": "Postgres",
      "credentials": {
        "postgres": {
          "id": "wAinN9wUEqKd2QYX",
          "name": "Postgres account 3"
        }
      }
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict",
            "version": 2
          },
          "conditions": [
            {
              "id": "cdb46475-1e9d-4293-b096-d2cce40c55e3",
              "leftValue": "={{ $json.email_exists }}",
              "rightValue": "",
              "operator": {
                "type": "boolean",
                "operation": "false",
                "singleValue": true
              }
            }
          ],
          "combinator": "and"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.if",
      "typeVersion": 2.2,
      "position": [
        240,
        -20
      ],
      "id": "68b0c36d-289c-41aa-8d5c-2416542ff6c1",
      "name": "If"
    },
    {
      "parameters": {
        "operation": "executeQuery",
        "query": "SELECT EXISTS (\n  SELECT 1 FROM clients WHERE email = '{{ $json.Email }}'\n) AS email_exists;\n",
        "options": {}
      },
      "type": "n8n-nodes-base.postgres",
      "typeVersion": 2.6,
      "position": [
        60,
        -20
      ],
      "id": "4340f718-846e-49e4-9d1b-14842c6a1995",
      "name": "Postgres1",
      "credentials": {
        "postgres": {
          "id": "wAinN9wUEqKd2QYX",
          "name": "Postgres account 3"
        }
      }
    },
    {
      "parameters": {
        "jsCode": "const id = $input.first().json.id;\nconst tax_year = $('On form submission').first().json['Tax Year']\nreturn [\n  {\n    json: {\n      folderPath: `/clients/${id}/${tax_year}/returns`\n    }\n  }\n];\n"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        720,
        -40
      ],
      "id": "3bce9e1a-3a96-431d-bc46-9669161f2bd5",
      "name": "Code"
    },
    {
      "parameters": {
        "resource": "folder",
        "name": "=Knowmas_Tax/{{ $json.folderPath }}",
        "driveId": {
          "__rl": true,
          "mode": "list",
          "value": "My Drive"
        },
        "folderId": {
          "__rl": true,
          "mode": "list",
          "value": "root",
          "cachedResultName": "/ (Root folder)"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.googleDrive",
      "typeVersion": 3,
      "position": [
        940,
        -40
      ],
      "id": "5b36e7ca-a455-479d-aaae-adfdf8957378",
      "name": "Google Drive",
      "credentials": {
        "googleDriveOAuth2Api": {
          "id": "3lFSIi87pkeGGmOT",
          "name": "Yoni"
        }
      }
    }
  ],
  "connections": {
    "On form submission": {
      "main": [
        [
          {
            "node": "Postgres1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "If": {
      "main": [
        [
          {
            "node": "Postgres",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Postgres1": {
      "main": [
        [
          {
            "node": "If",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Postgres": {
      "main": [
        [
          {
            "node": "Code",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Code": {
      "main": [
        [
          {
            "node": "Google Drive",
            "type": "main",
            "index": 0
          }
        ]
      ]
    }
  },
  "settings": {
    "executionOrder": "v1",
    "callerPolicy": "workflowsFromSameOwner",
    "errorWorkflow": "g8oVhs1GlKPeruvm"
  },
  "staticData": null,
  "meta": {
    "templateCredsSetupCompleted": true
  },
  "pinData": {},
  "versionId": "6ac13fc3-74a4-4f23-839a-801f2b83e614",
  "triggerCount": 0,
  "tags": [],
  "shared": [
    {
      "createdAt": "2025-07-02T07:42:29.406Z",
      "updatedAt": "2025-07-02T07:42:29.406Z",
      "role": "workflow:owner",
      "workflowId": "QIStyvPkZx56D18R",
      "projectId": "IQ4w3zW02fJzIdTt",
      "project": {
        "createdAt": "2025-01-25T02:11:56.995Z",
        "updatedAt": "2025-01-25T21:11:21.957Z",
        "id": "IQ4w3zW02fJzIdTt",
        "name": "Yonatan Tesfaye <yonatantesfaye30@gmail.com>",
        "type": "personal",
        "icon": null,
        "description": null
      }
    }
  ]
}