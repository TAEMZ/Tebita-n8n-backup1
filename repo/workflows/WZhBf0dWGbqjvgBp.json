{
  "createdAt": "2025-02-10T22:23:53.291Z",
  "updatedAt": "2025-02-10T22:30:37.583Z",
  "id": "WZhBf0dWGbqjvgBp",
  "name": "My workflow 6",
  "active": false,
  "isArchived": false,
  "nodes": [
    {
      "parameters": {
        "chatId": "={{ $('AI Agent1').item.json.output }}",
        "text": "={{ $json.output }}",
        "additionalFields": {
          "appendAttribution": false
        }
      },
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.2,
      "position": [
        1080,
        440
      ],
      "id": "b5761b34-34f7-4c5c-b42e-e1d99e44aa11",
      "name": "Telegram",
      "webhookId": "313d0df1-3d51-4b4b-aa4d-cc9f411a8a99",
      "credentials": {
        "telegramApi": {
          "id": "ipwa11TGrXDCJzY2",
          "name": "Telegram account"
        }
      }
    },
    {
      "parameters": {
        "rules": {
          "values": [
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 2
                },
                "conditions": [
                  {
                    "leftValue": "={{ $json.message.voice.file_id }}",
                    "rightValue": "",
                    "operator": {
                      "type": "string",
                      "operation": "exists",
                      "singleValue": true
                    }
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "Audio"
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 2
                },
                "conditions": [
                  {
                    "id": "940ed3d0-a2ae-4c20-a1ff-ed3b3bdd1f4f",
                    "leftValue": "={{ $json.chatInput }}",
                    "rightValue": "",
                    "operator": {
                      "type": "string",
                      "operation": "exists",
                      "singleValue": true
                    }
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "Chat"
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 2
                },
                "conditions": [
                  {
                    "id": "2de27c03-ff42-4c3f-bc63-6d1fc9136235",
                    "leftValue": "={{ $json.message.photo }}",
                    "rightValue": "",
                    "operator": {
                      "type": "array",
                      "operation": "exists",
                      "singleValue": true
                    }
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "Image"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.switch",
      "typeVersion": 3.2,
      "position": [
        -280,
        320
      ],
      "id": "09ff00d3-46f1-4614-bfd6-9c6085e21179",
      "name": "Switch"
    },
    {
      "parameters": {
        "resource": "file",
        "fileId": "={{ $json.message.voice.file_id }}"
      },
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.2,
      "position": [
        0,
        160
      ],
      "id": "2707800f-b351-41aa-9d99-b980540cfd0a",
      "name": "Get Audio",
      "webhookId": "3636eba8-8a15-4058-be9c-3661afa82c76",
      "credentials": {
        "telegramApi": {
          "id": "ipwa11TGrXDCJzY2",
          "name": "Telegram account"
        }
      }
    },
    {
      "parameters": {
        "resource": "audio",
        "operation": "transcribe",
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.openAi",
      "typeVersion": 1.8,
      "position": [
        180,
        160
      ],
      "id": "4bed9cc9-2723-4fef-a95c-777a8d972da6",
      "name": "OpenAI",
      "credentials": {
        "openAiApi": {
          "id": "9dZkBlQ9pjp5qbos",
          "name": "Openai1"
        }
      }
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "08164e61-0d33-41bb-b241-45e1979afb3e",
              "name": "=Chat",
              "value": "={{ $('Chat Trigger').item.json.chatInput }}",
              "type": "string"
            },
            {
              "id": "66f24e89-835d-4386-b804-9413d8aa8731",
              "name": "",
              "value": "",
              "type": "string"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        0,
        420
      ],
      "id": "79e90cbf-d86f-4836-9fd6-5e950894e869",
      "name": "Agent Input"
    },
    {
      "parameters": {
        "resource": "audio",
        "input": "={{ $('AI Agent1').item.json.output }}",
        "voice": "nova",
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.openAi",
      "typeVersion": 1.8,
      "position": [
        840,
        160
      ],
      "id": "3e99b736-c683-480a-b4ef-949458773854",
      "name": "Generate Audio",
      "credentials": {
        "openAiApi": {
          "id": "9dZkBlQ9pjp5qbos",
          "name": "Openai1"
        }
      }
    },
    {
      "parameters": {
        "operation": "sendAudio",
        "chatId": "={{ $('Telegram Trigger').item.json.message.chat.id }}",
        "binaryData": true,
        "additionalFields": {}
      },
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.2,
      "position": [
        1060,
        160
      ],
      "id": "75fa2c70-01ab-4a86-91d2-927b395bc1f9",
      "name": "Audio Response",
      "webhookId": "29804fc8-d41c-4a5f-aa28-a3af08a01aa0",
      "credentials": {
        "telegramApi": {
          "id": "ipwa11TGrXDCJzY2",
          "name": "Telegram account"
        }
      }
    },
    {
      "parameters": {
        "resource": "file",
        "fileId": "={{ $json.message.photo[0].file_id }}"
      },
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.2,
      "position": [
        0,
        0
      ],
      "id": "8f6700c4-0f59-42ca-8473-a0363f18baa8",
      "name": "Telegram1",
      "webhookId": "f1b64978-4d6a-4478-a89e-176d5cbbb6d6",
      "credentials": {
        "telegramApi": {
          "id": "ipwa11TGrXDCJzY2",
          "name": "Telegram account"
        }
      }
    },
    {
      "parameters": {
        "jsCode": "const inputItem = items[0];\nconst extension = inputItem.binary.data.fileExtension;\ninputItem.binary.data.mimeType = `image/${extension}`;\nreturn inputItem;\n"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        220,
        0
      ],
      "id": "ba39d9a6-37ba-4cb5-b83e-34e21a6532c8",
      "name": "Code"
    },
    {
      "parameters": {
        "resource": "image",
        "operation": "analyze",
        "modelId": {
          "__rl": true,
          "value": "chatgpt-4o-latest",
          "mode": "list",
          "cachedResultName": "CHATGPT-4O-LATEST"
        },
        "text": "={{ $('Telegram Trigger').item.json.message.caption || \"Describe the image\"}}",
        "inputType": "base64",
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.openAi",
      "typeVersion": 1.8,
      "position": [
        440,
        0
      ],
      "id": "26908f9d-c71d-4c32-a53d-53b2f0e4d721",
      "name": "Analyze Image",
      "credentials": {
        "openAiApi": {
          "id": "9dZkBlQ9pjp5qbos",
          "name": "Openai1"
        }
      }
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "36febc7f-c3a7-4a39-90a7-fb22a3891e23",
              "name": "output",
              "value": "={{ $json.content }}",
              "type": "string"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        660,
        0
      ],
      "id": "b66f5365-50ba-4fb8-8f4f-3040644007d6",
      "name": "Format Image"
    },
    {
      "parameters": {
        "promptType": "define",
        "text": "={{ $json.Chat }}",
        "options": {
          "systemMessage": "=# ROLE\nYou are a friendly and helpful assistant called Elnathan. Keep your answer short and to the point.\n\n#ADDITIONAL INFORMATION\nYou are currently chatting to {{ $json.message.from.first_name }}.\nThe current date and time is {{ $now }}\n\n#TOOLS\n## Read Emails\nUse this tool to retrieve unread emails.\n\n##Send Emails\nUse this tool to send emails. This tools requires the recipient email, the email subject, and body text.\n\n##Get Calendar\nUse this tool to retrieve events from calendar.\n\n##Create Event\nUse this tool to schedule events to a calendar.\n\n## Configure Phone\nUse this tool to configure a phone to CUCM"
        }
      },
      "type": "@n8n/n8n-nodes-langchain.agent",
      "typeVersion": 1.7,
      "position": [
        300,
        340
      ],
      "id": "d12fc5ec-c43f-4fe7-aa75-65314ebe5130",
      "name": "AI Agent1"
    },
    {
      "parameters": {
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.lmChatOpenAi",
      "typeVersion": 1.1,
      "position": [
        0,
        780
      ],
      "id": "9384f9d7-a18a-41d3-976d-3142a7ba8b4f",
      "name": "OpenAI Chat Model1",
      "credentials": {
        "openAiApi": {
          "id": "9dZkBlQ9pjp5qbos",
          "name": "Openai1"
        }
      }
    },
    {
      "parameters": {
        "sessionIdType": "customKey",
        "sessionKey": "{{ $json.message.chat.id }}",
        "contextWindowLength": 20
      },
      "type": "@n8n/n8n-nodes-langchain.memoryBufferWindow",
      "typeVersion": 1.3,
      "position": [
        140,
        820
      ],
      "id": "813843e5-4bab-482e-8c9d-5e5f56cbd17b",
      "name": "Window Buffer Memory1"
    },
    {
      "parameters": {
        "public": true,
        "options": {
          "allowedOrigins": "*"
        }
      },
      "type": "@n8n/n8n-nodes-langchain.chatTrigger",
      "typeVersion": 1.1,
      "position": [
        -560,
        340
      ],
      "id": "16513abc-699e-454e-8792-3707cd42714a",
      "name": "Chat Trigger",
      "webhookId": "0638fe95-2a53-48a9-b06c-af9558f09809"
    },
    {
      "parameters": {
        "rules": {
          "values": [
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 2
                },
                "conditions": [
                  {
                    "leftValue": "={{ $('Switch').item.json.chatInput }}",
                    "rightValue": "add phone",
                    "operator": {
                      "type": "string",
                      "operation": "contains"
                    }
                  }
                ],
                "combinator": "and"
              }
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 2
                },
                "conditions": [
                  {
                    "id": "0415f640-99a3-448f-8140-e86df231e3ae",
                    "leftValue": "={{ $('Switch').item.json.chatInput }}",
                    "rightValue": "add user",
                    "operator": {
                      "type": "string",
                      "operation": "contains"
                    }
                  }
                ],
                "combinator": "and"
              }
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 2
                },
                "conditions": [
                  {
                    "id": "273e4d64-959d-4cdc-9a0d-7c504f64b046",
                    "leftValue": "{{ $('Switch').item.json.Telegram }}",
                    "rightValue": "voice",
                    "operator": {
                      "type": "string",
                      "operation": "contains"
                    }
                  }
                ],
                "combinator": "and"
              }
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 2
                },
                "conditions": [
                  {
                    "id": "791c0946-8e47-43db-ba5b-a7723c9079ad",
                    "leftValue": "={{ $('Switch').item.json.chatInput }}",
                    "rightValue": "delete user",
                    "operator": {
                      "type": "string",
                      "operation": "contains"
                    }
                  }
                ],
                "combinator": "and"
              }
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 2
                },
                "conditions": [
                  {
                    "id": "4da5edd5-0462-42e2-8d8f-3474a9b16d7b",
                    "leftValue": "={{ $('Switch').item.json.chatInput }}",
                    "rightValue": "reset phone",
                    "operator": {
                      "type": "string",
                      "operation": "equals",
                      "name": "filter.operator.equals"
                    }
                  }
                ],
                "combinator": "and"
              }
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 2
                },
                "conditions": [
                  {
                    "id": "166146e0-aea3-48de-8bee-83671f06525a",
                    "leftValue": "={{ $('Switch').item.json.chatInput }}",
                    "rightValue": "",
                    "operator": {
                      "type": "string",
                      "operation": "exists",
                      "singleValue": true
                    }
                  }
                ],
                "combinator": "and"
              }
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.switch",
      "typeVersion": 3.2,
      "position": [
        580,
        320
      ],
      "id": "bb549d4e-c075-435e-bc61-3cb0b99bf792",
      "name": "Switch1"
    }
  ],
  "connections": {
    "Switch": {
      "main": [
        [
          {
            "node": "Get Audio",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Agent Input",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Telegram1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Get Audio": {
      "main": [
        [
          {
            "node": "OpenAI",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "OpenAI": {
      "main": [
        [
          {
            "node": "AI Agent1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Agent Input": {
      "main": [
        [
          {
            "node": "AI Agent1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Generate Audio": {
      "main": [
        [
          {
            "node": "Audio Response",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Telegram1": {
      "main": [
        [
          {
            "node": "Code",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Code": {
      "main": [
        [
          {
            "node": "Analyze Image",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Analyze Image": {
      "main": [
        [
          {
            "node": "Format Image",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Format Image": {
      "main": [
        [
          {
            "node": "Telegram",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "AI Agent1": {
      "main": [
        [
          {
            "node": "Switch1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "OpenAI Chat Model1": {
      "ai_languageModel": [
        [
          {
            "node": "AI Agent1",
            "type": "ai_languageModel",
            "index": 0
          }
        ]
      ]
    },
    "Window Buffer Memory1": {
      "ai_memory": [
        [
          {
            "node": "AI Agent1",
            "type": "ai_memory",
            "index": 0
          }
        ]
      ]
    },
    "Chat Trigger": {
      "main": [
        [
          {
            "node": "Switch",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Switch1": {
      "main": [
        [],
        [],
        [
          {
            "node": "Generate Audio",
            "type": "main",
            "index": 0
          }
        ],
        [],
        [],
        []
      ]
    }
  },
  "settings": {
    "executionOrder": "v1"
  },
  "staticData": null,
  "meta": {
    "templateCredsSetupCompleted": true
  },
  "pinData": {},
  "versionId": "7fe4cd94-3f19-4b32-bf5e-8b3b58c1f4bb",
  "triggerCount": 1,
  "tags": [],
  "shared": [
    {
      "createdAt": "2025-02-10T22:23:53.291Z",
      "updatedAt": "2025-02-10T22:23:53.291Z",
      "role": "workflow:owner",
      "workflowId": "WZhBf0dWGbqjvgBp",
      "projectId": "IQ4w3zW02fJzIdTt",
      "project": {
        "createdAt": "2025-01-25T02:11:56.995Z",
        "updatedAt": "2025-01-25T21:11:21.957Z",
        "id": "IQ4w3zW02fJzIdTt",
        "name": "Yonatan Tesfaye <yonatantesfaye30@gmail.com>",
        "type": "personal",
        "icon": null,
        "description": null
      }
    }
  ]
}