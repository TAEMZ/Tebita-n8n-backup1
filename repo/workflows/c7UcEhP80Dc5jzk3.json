{
  "createdAt": "2025-09-08T10:44:13.512Z",
  "updatedAt": "2025-10-08T09:50:40.172Z",
  "id": "c7UcEhP80Dc5jzk3",
  "name": "cis email & meeting test",
  "active": false,
  "isArchived": false,
  "nodes": [
    {
      "parameters": {
        "pollTimes": {
          "item": [
            {
              "mode": "everyMinute"
            }
          ]
        },
        "simple": false,
        "filters": {},
        "options": {
          "downloadAttachments": true
        }
      },
      "type": "n8n-nodes-base.gmailTrigger",
      "typeVersion": 1.2,
      "position": [
        -1296,
        128
      ],
      "id": "e0fd7a7b-26cd-46c2-b635-f68292b28303",
      "name": "Gmail Trigger",
      "credentials": {
        "gmailOAuth2": {
          "id": "U9j5tOtd70hTCiq3",
          "name": "kefe"
        }
      }
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "db045712-6f14-4269-95c4-3e8e8330383c",
              "name": "From",
              "value": "={{ $('separate name and email').item.json.from.name }}",
              "type": "string"
            },
            {
              "id": "ef0fcd35-0dbb-44eb-b1bb-b93697bc0658",
              "name": "Subject",
              "value": "={{ $('Loop Over Items').item.json.headers.subject }}",
              "type": "string"
            },
            {
              "id": "cc6cf6cb-d160-44b0-903b-65209acc94f3",
              "name": "To",
              "value": "={{ $('separate name and email').item.json.to[0].name }}",
              "type": "string"
            },
            {
              "id": "00d3b4a9-d888-4192-9e2a-4bab86bca6f4",
              "name": "internalDate",
              "value": "={{ $('Loop Over Items').item.json.headers.date }}",
              "type": "string"
            },
            {
              "id": "06d49d99-f657-40fa-91e1-a6caed41d875",
              "name": "snippet",
              "value": "={{ $('Loop Over Items').item.json.text }}",
              "type": "string"
            },
            {
              "id": "78146ab9-5346-4889-a994-601a1c3947c6",
              "name": "source_type",
              "value": "=email",
              "type": "string"
            },
            {
              "id": "7d3c3936-27b7-45cb-aa1e-9641a8507ad3",
              "name": "client",
              "value": "={{ $json.name }}",
              "type": "string"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        720,
        -240
      ],
      "id": "f3e2ef1f-82c9-431a-aca8-42c6fff63f20",
      "name": "Edit Fields"
    },
    {
      "parameters": {
        "promptType": "define",
        "text": "=You are a strict text-cleaning assistant.\n\nTask:\n‚Ä¢ Take the input email text and remove signatures, footers, quoted replies, and extra spaces.\n‚Ä¢ Keep all actual message content exactly as written‚Äîno summaries, no rephrasing.\n\nRules:\n‚Ä¢ Do not add or invent any text.\n‚Ä¢ Output a single JSON object in this structure:\n\n{\n  \"date\": \"<date>\",\n  \"content\": \"<cleaned email text>\"\n}\n\nInput email text:{{  $('Edit Fields').item.json.snippet }}\nchange this date to utc: {{  $('Edit Fields').item.json.internalDate }}\n",
        "hasOutputParser": true,
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.agent",
      "typeVersion": 1.9,
      "position": [
        896,
        -240
      ],
      "id": "4c97a312-21ca-43ef-8a83-b58f5aab5702",
      "name": "AI Agent"
    },
    {
      "parameters": {
        "model": {
          "__rl": true,
          "mode": "list",
          "value": "gpt-4o-mini"
        },
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.lmChatOpenAi",
      "typeVersion": 1.2,
      "position": [
        880,
        -48
      ],
      "id": "8095e61b-6c6e-405e-9c6b-6cda9211f680",
      "name": "OpenAI Chat Model",
      "credentials": {
        "openAiApi": {
          "id": "P97bW4SECej7SdA6",
          "name": "don't use this eric"
        }
      }
    },
    {
      "parameters": {
        "options": {}
      },
      "type": "n8n-nodes-base.dateTimeTool",
      "typeVersion": 2,
      "position": [
        1008,
        -32
      ],
      "id": "3b766146-fd5d-4b39-80ac-b2a7818ca022",
      "name": "Date & Time"
    },
    {
      "parameters": {
        "jsonSchemaExample": "{\n\t\"content\": \"content\",\n    \"date\":\"date\"\n}"
      },
      "type": "@n8n/n8n-nodes-langchain.outputParserStructured",
      "typeVersion": 1.3,
      "position": [
        1104,
        16
      ],
      "id": "193c2d84-e241-46bc-9017-74613d64f0fd",
      "name": "Structured Output Parser"
    },
    {
      "parameters": {
        "public": true,
        "options": {
          "allowedOrigins": "https://cis-chat.vercel.app/",
          "responseMode": "lastNode"
        }
      },
      "type": "@n8n/n8n-nodes-langchain.chatTrigger",
      "typeVersion": 1.3,
      "position": [
        2064,
        1520
      ],
      "id": "263dddad-a366-423d-9407-d9f2ca4d40db",
      "name": "When chat message received",
      "webhookId": "1a7178e7-365d-433b-bc1d-07ab98fd6a4c"
    },
    {
      "parameters": {
        "promptType": "define",
        "text": "={{ $json.client }} {{ $json.chatInput }}",
        "options": {
          "systemMessage": "You are a Client Intelligence Assistant.\nUse Supabase to fetch relevant data and answer user queries.\n\nüîπ Core Rules\n\nClient-specific vs. general questions\n\nIf the question clearly concerns a specific client but no client name is given, politely ask for the client‚Äôs name before continuing.\n\nIf the question is general (e.g., weekly summaries, overall metrics, or portfolio-wide updates), answer directly without requesting a client name.\n\nDo not guess or invent a client name.\n\nAlways query Supabase for the most relevant context before answering.\n\nüîπ Sources\n\nData may come from Slack messages, emails, meeting notes, or chat logs.\n\nüîπ Response Guidelines\n\nInclude the client or sender‚Äôs name and the date (from metadata) in every answer that involves a specific client.\n\nOptionally include the source type (Slack, Email, etc.) if it adds clarity.\n\nUse second-person phrasing (‚Äúyou,‚Äù ‚Äúyour company,‚Äù ‚Äúyour portfolio‚Äù).\n\nKeep tone conversational but grounded in retrieved context.\n\nüîπ Multiple Clients\n\nWhen several clients are mentioned, separate their information and attribute each piece to the correct sender + source + date.\n\nüîπ No Context\n\nIf Supabase has no relevant data for a specified client, politely state that you couldn‚Äôt find matching context.\n\nüîπ Time Awareness\n\nUse date metadata so responses remain current and relevant."
        }
      },
      "type": "@n8n/n8n-nodes-langchain.agent",
      "typeVersion": 2.2,
      "position": [
        2272,
        1520
      ],
      "id": "af523683-5101-4003-bf7c-815b73f01e76",
      "name": "AI Agent1"
    },
    {
      "parameters": {
        "model": {
          "__rl": true,
          "mode": "list",
          "value": "gpt-4.1-mini"
        },
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.lmChatOpenAi",
      "typeVersion": 1.2,
      "position": [
        2240,
        1744
      ],
      "id": "cd869771-aec7-4874-84cf-aea03a8eea73",
      "name": "OpenAI Chat Model1",
      "credentials": {
        "openAiApi": {
          "id": "P97bW4SECej7SdA6",
          "name": "don't use this eric"
        }
      }
    },
    {
      "parameters": {
        "options": {}
      },
      "type": "n8n-nodes-base.dateTimeTool",
      "typeVersion": 2,
      "position": [
        2432,
        1808
      ],
      "id": "9c1a7687-e0ab-4c6f-8216-27d8a9440a33",
      "name": "Date & Time1"
    },
    {
      "parameters": {
        "mode": "retrieve-as-tool",
        "toolDescription": "client information stored here",
        "tableName": {
          "__rl": true,
          "value": "cis",
          "mode": "list",
          "cachedResultName": "cis"
        },
        "options": {
          "queryName": "match_cis"
        }
      },
      "type": "@n8n/n8n-nodes-langchain.vectorStoreSupabase",
      "typeVersion": 1.3,
      "position": [
        2528,
        1632
      ],
      "id": "fdccaba2-6dde-4648-97a4-5e98f80ca1fc",
      "name": "Supabase Vector Store2",
      "credentials": {
        "supabaseApi": {
          "id": "hh3dnHsjI82CZcfO",
          "name": "Unnamed credential Yo"
        }
      }
    },
    {
      "parameters": {
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.embeddingsOpenAi",
      "typeVersion": 1.2,
      "position": [
        2528,
        1760
      ],
      "id": "d0821ce0-2acf-4632-b931-53bf15f7de5f",
      "name": "Embeddings OpenAI2",
      "credentials": {
        "openAiApi": {
          "id": "P97bW4SECej7SdA6",
          "name": "don't use this eric"
        }
      }
    },
    {
      "parameters": {
        "path": "7b21f37c-8da8-40d9-a14f-a27151aa8f2e",
        "responseMode": "lastNode",
        "options": {
          "allowedOrigins": "https://cis-chat.vercel.app/"
        }
      },
      "type": "n8n-nodes-base.webhook",
      "typeVersion": 2.1,
      "position": [
        1008,
        1616
      ],
      "id": "e48e79d9-4a50-49d7-9a92-54839439c602",
      "name": "Webhook",
      "webhookId": "7b21f37c-8da8-40d9-a14f-a27151aa8f2e"
    },
    {
      "parameters": {
        "promptType": "define",
        "text": "get all the clients names and return them as json exactly like this: \n{\n\"clients\": [\"client1\",\"client2\",... ]\n}",
        "hasOutputParser": true,
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.agent",
      "typeVersion": 2.2,
      "position": [
        1216,
        1616
      ],
      "id": "202586be-08c9-4790-99c6-e3a147dc9863",
      "name": "AI Agent2"
    },
    {
      "parameters": {
        "jsonSchemaExample": "{\n\"clients\": [\n  \"client1\",\n  \"client2\",\n  \"client2\" \n  ]\n}"
      },
      "type": "@n8n/n8n-nodes-langchain.outputParserStructured",
      "typeVersion": 1.3,
      "position": [
        1392,
        1824
      ],
      "id": "572b963c-a38c-492f-b083-8591428e02d9",
      "name": "Structured Output Parser1"
    },
    {
      "parameters": {
        "model": {
          "__rl": true,
          "mode": "list",
          "value": "gpt-4.1-mini"
        },
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.lmChatOpenAi",
      "typeVersion": 1.2,
      "position": [
        1072,
        1824
      ],
      "id": "49bae18d-a5eb-493a-b4e6-aaee8e8b769b",
      "name": "OpenAI Chat Model2",
      "credentials": {
        "openAiApi": {
          "id": "P97bW4SECej7SdA6",
          "name": "don't use this eric"
        }
      }
    },
    {
      "parameters": {
        "mode": "retrieve-as-tool",
        "toolDescription": "list of clients",
        "tableName": {
          "__rl": true,
          "value": "cis",
          "mode": "list",
          "cachedResultName": "cis"
        },
        "topK": 100,
        "options": {
          "queryName": "match_cls"
        }
      },
      "type": "@n8n/n8n-nodes-langchain.vectorStoreSupabase",
      "typeVersion": 1.3,
      "position": [
        1504,
        1744
      ],
      "id": "c59260a5-3ab0-45fb-a2b9-7272e4479cfb",
      "name": "Supabase Vector Store1",
      "credentials": {
        "supabaseApi": {
          "id": "hh3dnHsjI82CZcfO",
          "name": "Unnamed credential Yo"
        }
      }
    },
    {
      "parameters": {
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.embeddingsOpenAi",
      "typeVersion": 1.2,
      "position": [
        1632,
        1904
      ],
      "id": "6584a6b9-9ee8-4fdd-a607-28b10a37e916",
      "name": "Embeddings OpenAI1",
      "credentials": {
        "openAiApi": {
          "id": "P97bW4SECej7SdA6",
          "name": "don't use this eric"
        }
      }
    },
    {
      "parameters": {
        "sessionIdType": "customKey",
        "sessionKey": "={{ $json.sessionId }}"
      },
      "type": "@n8n/n8n-nodes-langchain.memoryBufferWindow",
      "typeVersion": 1.3,
      "position": [
        2336,
        1776
      ],
      "id": "4ebe37c2-8956-4cb4-8fcd-025a4ea272a4",
      "name": "Simple Memory"
    },
    {
      "parameters": {
        "content": "## list of clients",
        "height": 592,
        "width": 944
      },
      "type": "n8n-nodes-base.stickyNote",
      "position": [
        864,
        1520
      ],
      "typeVersion": 1,
      "id": "7a8cef31-4092-431e-9311-9a54ddc03c0e",
      "name": "Sticky Note"
    },
    {
      "parameters": {
        "content": "## CIS helper",
        "height": 496,
        "width": 800,
        "color": 4
      },
      "type": "n8n-nodes-base.stickyNote",
      "position": [
        2000,
        1456
      ],
      "typeVersion": 1,
      "id": "bc250dde-198e-4683-a878-5d510563c576",
      "name": "Sticky Note1"
    },
    {
      "parameters": {
        "content": "## Processes emails sent from clients",
        "height": 1760,
        "width": 3088,
        "color": 5
      },
      "type": "n8n-nodes-base.stickyNote",
      "position": [
        -1376,
        -368
      ],
      "typeVersion": 1,
      "id": "c3cf2412-9bda-4f16-bdf3-56f2930363fb",
      "name": "Sticky Note2"
    },
    {
      "parameters": {
        "jsCode": "function parse(str) {\n  const match = str.match(/^(.*?)(?:\\s*<([^>]+)>)?$/);\n  return {\n    name: (match[1] || \"\").trim().replace(/^\"|\"$/g, \"\"),\n    email: match[2] || (match[1] || \"\").trim()\n  };\n}\n\nreturn [{\n  json: {\n    from: parse($input.first().json.from.text),\n    to: ( $input.first().json.to.text|| \"\")\n          .split(',')\n          .map(t => parse(t.trim()))\n  }\n}];\n"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        -32,
        -224
      ],
      "id": "cc69f528-b9de-4a59-8222-5e0a507cae87",
      "name": "separate name and email"
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict",
            "version": 2
          },
          "conditions": [
            {
              "id": "59d4b853-ee3b-4539-83fc-e3b0731dfe93",
              "leftValue": "={{ $json.isEmpty() }}",
              "rightValue": "",
              "operator": {
                "type": "boolean",
                "operation": "false",
                "singleValue": true
              }
            }
          ],
          "combinator": "and"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.if",
      "typeVersion": 2.2,
      "position": [
        400,
        -224
      ],
      "id": "580fdbf3-f40b-4030-a1f7-a767fe687c48",
      "name": "If"
    },
    {
      "parameters": {
        "operation": "get",
        "tableId": "clients",
        "filters": {
          "conditions": [
            {
              "keyName": "name",
              "keyValue": "={{ $json.from.name }}"
            },
            {
              "keyName": "email",
              "keyValue": "={{ $json.from.email }}"
            }
          ]
        }
      },
      "type": "n8n-nodes-base.supabase",
      "typeVersion": 1,
      "position": [
        224,
        -224
      ],
      "id": "d782dd8e-8fad-48a5-a60f-3adb7c71aad4",
      "name": "Check from",
      "alwaysOutputData": true,
      "credentials": {
        "supabaseApi": {
          "id": "hh3dnHsjI82CZcfO",
          "name": "Unnamed credential Yo"
        }
      }
    },
    {
      "parameters": {
        "operation": "get",
        "tableId": "clients",
        "filters": {
          "conditions": [
            {
              "keyName": "name",
              "keyValue": "={{ $('separate name and email').item.json.to[0].name }}"
            },
            {
              "keyName": "email",
              "keyValue": "={{ $('separate name and email').item.json.to[0].email }}"
            }
          ]
        }
      },
      "type": "n8n-nodes-base.supabase",
      "typeVersion": 1,
      "position": [
        224,
        -80
      ],
      "id": "cdd892d7-2276-403b-b953-1b344c823875",
      "name": "Check to",
      "alwaysOutputData": true,
      "credentials": {
        "supabaseApi": {
          "id": "hh3dnHsjI82CZcfO",
          "name": "Unnamed credential Yo"
        }
      }
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict",
            "version": 2
          },
          "conditions": [
            {
              "id": "59d4b853-ee3b-4539-83fc-e3b0731dfe93",
              "leftValue": "={{ $json.isEmpty() }}",
              "rightValue": "",
              "operator": {
                "type": "boolean",
                "operation": "false",
                "singleValue": true
              }
            }
          ],
          "combinator": "and"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.if",
      "typeVersion": 2.2,
      "position": [
        400,
        -80
      ],
      "id": "2fdc1c33-250e-4102-a580-c52514dac6c6",
      "name": "If1"
    },
    {
      "parameters": {
        "tableId": "clients",
        "fieldsUi": {
          "fieldValues": [
            {
              "fieldId": "name",
              "fieldValue": "={{ $json.from.name }}"
            },
            {
              "fieldId": "email",
              "fieldValue": "={{ $json.from.email }}"
            }
          ]
        }
      },
      "type": "n8n-nodes-base.supabase",
      "typeVersion": 1,
      "position": [
        -2048,
        816
      ],
      "id": "e0115564-73f5-438e-811d-6876962c95b5",
      "name": "Create a row",
      "credentials": {
        "supabaseApi": {
          "id": "hh3dnHsjI82CZcfO",
          "name": "Unnamed credential Yo"
        }
      }
    },
    {
      "parameters": {
        "content": "## Also send binary data",
        "height": 224,
        "width": 304,
        "color": 6
      },
      "type": "n8n-nodes-base.stickyNote",
      "position": [
        -720,
        160
      ],
      "typeVersion": 1,
      "id": "4bc34ae9-9d4f-47d1-802c-81a6ce64e3cf",
      "name": "Sticky Note3"
    },
    {
      "parameters": {
        "content": "## Clean text, generate metadata and send to rag",
        "height": 496,
        "width": 944,
        "color": 6
      },
      "type": "n8n-nodes-base.stickyNote",
      "position": [
        656,
        -336
      ],
      "typeVersion": 1,
      "id": "d6c6161a-99e0-41c0-8af4-1229f965b6a0",
      "name": "Sticky Note4"
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "65322511-d1fc-4106-a7ba-f8dbe5f16167",
              "name": "client_name",
              "value": "={{ $('Edit Fields').item.json.client }}",
              "type": "string"
            },
            {
              "id": "ba1bfb90-4f84-43ea-bc00-fe0982f46349",
              "name": "content",
              "value": "=subject: {{ $('Edit Fields').item.json.Subject }}. \nmessage: {{ $('Edit Fields').item.json.snippet }}. \ncontent:{{ $json.output.content }}",
              "type": "string"
            },
            {
              "id": "f7f5b514-2759-4350-93dd-5862120b9154",
              "name": "date",
              "value": "={{ $json.output.date }}",
              "type": "string"
            },
            {
              "id": "34f372f5-10c6-442f-8eca-800e7cef2baf",
              "name": "source_type",
              "value": "={{ $('Edit Fields').item.json.source_type }}",
              "type": "string"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        1232,
        -240
      ],
      "id": "711e21b5-c71b-471d-bd3e-748dde5a6b3c",
      "name": "Edit Fields1"
    },
    {
      "parameters": {
        "options": {}
      },
      "type": "n8n-nodes-base.splitInBatches",
      "typeVersion": 3,
      "position": [
        -272,
        -240
      ],
      "id": "6d2a4559-97dd-457a-bf77-1ccbbd72dbe4",
      "name": "Loop Over Items"
    },
    {
      "parameters": {
        "pollTimes": {
          "item": [
            {
              "mode": "everyMinute"
            }
          ]
        },
        "filters": {}
      },
      "type": "n8n-nodes-base.gmailTrigger",
      "typeVersion": 1.3,
      "position": [
        -2368,
        1808
      ],
      "id": "3e473fee-eaf1-42b6-b143-2abc5815499f",
      "name": "Gmail Trigger1",
      "credentials": {
        "gmailOAuth2": {
          "id": "YZJy04K90HmM6neC",
          "name": "yonatantesfaye30@gmail.com"
        }
      }
    },
    {
      "parameters": {
        "workflowId": {
          "__rl": true,
          "value": "WIHMBpRis9b20wAv",
          "mode": "list",
          "cachedResultName": "CIS Rag test"
        },
        "workflowInputs": {
          "mappingMode": "defineBelow",
          "value": {
            "client_name": "={{ $json.client_name }}",
            "date": "={{$json.date}}",
            "source_type": "={{$json.source_type}}",
            "content": "={{ $json.content }}"
          },
          "matchingColumns": [],
          "schema": [
            {
              "id": "client_name",
              "displayName": "client_name",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "canBeUsedToMatch": true,
              "type": "string",
              "removed": false
            },
            {
              "id": "date",
              "displayName": "date",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "canBeUsedToMatch": true,
              "type": "string",
              "removed": false
            },
            {
              "id": "source_type",
              "displayName": "source_type",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "canBeUsedToMatch": true,
              "type": "string",
              "removed": false
            },
            {
              "id": "content",
              "displayName": "content",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "canBeUsedToMatch": true,
              "type": "string",
              "removed": false
            }
          ],
          "attemptToConvertTypes": false,
          "convertFieldsToString": true
        },
        "options": {}
      },
      "type": "n8n-nodes-base.executeWorkflow",
      "typeVersion": 1.2,
      "position": [
        1424,
        -240
      ],
      "id": "2d77ef81-c2d4-4316-a30a-a7de43e5b7e3",
      "name": "Call 'rag'"
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "1249ac1d-f62f-4c87-b20b-2bd364967aa8",
              "name": "source_type",
              "value": "email_with_file",
              "type": "string"
            },
            {
              "id": "9b452cf6-d268-4ed5-98ed-59b701a8b117",
              "name": "client_name",
              "value": "={{ $json.output[\"client name\"] }}",
              "type": "string"
            },
            {
              "id": "46b51ef8-b4ee-4fa6-9747-e4f7d66c1bf8",
              "name": "content",
              "value": "={{ $('separate name and email1').item.json.headers.subject }} Body: {{ $json.output.content }}",
              "type": "string"
            },
            {
              "id": "ad5c3df9-427b-46ba-a858-df2a66aeddc3",
              "name": "date",
              "value": "={{ $json.output.date }}",
              "type": "string"
            }
          ]
        },
        "includeOtherFields": true,
        "options": {}
      },
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        1120,
        256
      ],
      "id": "0ae0dbe2-1418-44cf-a63e-345f65d8bd43",
      "name": "Edit Fields2"
    },
    {
      "parameters": {
        "jsCode": "// Helper function to parse \"Name <email@example.com>\" strings\nfunction parse(str) {\n    if (!str) return { name: \"\", email: \"\" };\n    const match = str.match(/^(.*?)(?:\\s*<([^>]+)>)?$/);\n    return {\n        name: (match[1] || \"\").trim().replace(/^\"|\"$/g, \"\"),\n        email: match[2] || (match[1] || \"\").trim()\n    };\n}\n\n// Get the first incoming item\nconst item = $input.first();\n\n// Return the modified JSON while keeping binary intact\nreturn [{\n    json: {\n        ...item.json,  // keep all original json fields\n        from: parse(item.json.from?.text),\n        to: (item.json.to?.text || \"\")\n              .split(',')\n              .map(t => parse(t.trim()))\n    },\n    binary: item.binary // preserve all original binary data\n}];\n"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        -608,
        240
      ],
      "id": "55beb028-abf1-4441-90bf-be9b034684a1",
      "name": "separate name and email1"
    },
    {
      "parameters": {
        "promptType": "define",
        "text": "=You are a strict text-cleaning assistant.\n\nTask:\n‚Ä¢ Take the input email text and remove signatures, footers, quoted replies, and extra spaces.\n‚Ä¢ Keep all actual message content exactly as written‚Äîno summaries, no rephrasing.\n\nRules:\n‚Ä¢ Do not add or invent any text.\n‚Ä¢ Output a single JSON object in this structure:\n\n{\n  \"date\": \"<date>\",\n  \"content\": \"<cleaned email text>\"\n  \"client name\": \"<client name>\"\n  \"client email\": \"<client email>\"\n}\ndate(convert to utc if it isn't):{{ $('separate name and email1').item.json.headers.date }}\nInput email text:{{ $('separate name and email1').item.json.text }}\nclient_name: {{ $json.name }}\nclient_email: {{ $json.email }}\n\n",
        "hasOutputParser": true,
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.agent",
      "typeVersion": 1.9,
      "position": [
        224,
        176
      ],
      "id": "06b59ef1-fcaa-4d9d-8b95-e98a6e1195ef",
      "name": "AI Agent3"
    },
    {
      "parameters": {
        "model": {
          "__rl": true,
          "mode": "list",
          "value": "gpt-4o-mini"
        },
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.lmChatOpenAi",
      "typeVersion": 1.2,
      "position": [
        208,
        336
      ],
      "id": "1534cf85-5577-4ff6-b2dc-4d1c65179a12",
      "name": "OpenAI Chat Model3",
      "credentials": {
        "openAiApi": {
          "id": "P97bW4SECej7SdA6",
          "name": "don't use this eric"
        }
      }
    },
    {
      "parameters": {
        "options": {}
      },
      "type": "n8n-nodes-base.dateTimeTool",
      "typeVersion": 2,
      "position": [
        320,
        336
      ],
      "id": "e35aebb1-9fc5-4874-a4b5-0ad7e19a3598",
      "name": "Date & Time2"
    },
    {
      "parameters": {
        "jsonSchemaExample": "{\n\t\"content\": \"content\",\n    \"date\":\"date\",\n  \"client name\": \"<client name>\",\n  \"client email\": \"<client email>\"\n}"
      },
      "type": "@n8n/n8n-nodes-langchain.outputParserStructured",
      "typeVersion": 1.3,
      "position": [
        416,
        352
      ],
      "id": "647ceac2-914f-4201-b2db-9f5319943d42",
      "name": "Structured Output Parser2"
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict",
            "version": 2
          },
          "conditions": [
            {
              "id": "59d4b853-ee3b-4539-83fc-e3b0731dfe93",
              "leftValue": "={{ $json.isEmpty() }}",
              "rightValue": "",
              "operator": {
                "type": "boolean",
                "operation": "false",
                "singleValue": true
              }
            }
          ],
          "combinator": "and"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.if",
      "typeVersion": 2.2,
      "position": [
        -128,
        144
      ],
      "id": "08eecb05-240a-4373-abf7-c115165d8b10",
      "name": "If3"
    },
    {
      "parameters": {
        "operation": "get",
        "tableId": "clients",
        "filters": {
          "conditions": [
            {
              "keyName": "name",
              "keyValue": "={{ $json.from.name }}"
            },
            {
              "keyName": "email",
              "keyValue": "={{ $json.from.email }}"
            }
          ]
        }
      },
      "type": "n8n-nodes-base.supabase",
      "typeVersion": 1,
      "position": [
        -320,
        144
      ],
      "id": "32f176ee-ce82-4921-9e3e-ede34f948f6a",
      "name": "Check from1",
      "alwaysOutputData": true,
      "credentials": {
        "supabaseApi": {
          "id": "hh3dnHsjI82CZcfO",
          "name": "Unnamed credential Yo"
        }
      }
    },
    {
      "parameters": {
        "operation": "get",
        "tableId": "clients",
        "filters": {
          "conditions": [
            {
              "keyName": "name",
              "keyValue": "={{ $('separate name and email1').item.json.to[0].name }}"
            },
            {
              "keyName": "email",
              "keyValue": "={{ $('separate name and email1').item.json.to[0].email }}"
            }
          ]
        }
      },
      "type": "n8n-nodes-base.supabase",
      "typeVersion": 1,
      "position": [
        -320,
        288
      ],
      "id": "e925b43d-ec9d-4fb5-8aa2-5fcb92c9b8cc",
      "name": "Check to1",
      "alwaysOutputData": true,
      "credentials": {
        "supabaseApi": {
          "id": "hh3dnHsjI82CZcfO",
          "name": "Unnamed credential Yo"
        }
      }
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict",
            "version": 2
          },
          "conditions": [
            {
              "id": "59d4b853-ee3b-4539-83fc-e3b0731dfe93",
              "leftValue": "={{ $json.isEmpty() }}",
              "rightValue": "",
              "operator": {
                "type": "boolean",
                "operation": "false",
                "singleValue": true
              }
            }
          ],
          "combinator": "and"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.if",
      "typeVersion": 2.2,
      "position": [
        -112,
        288
      ],
      "id": "5776deb7-079c-458d-bc6b-55e14997fd6b",
      "name": "If4"
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict",
            "version": 2
          },
          "conditions": [
            {
              "id": "072d0abe-a993-4eb4-a619-04a2d1703879",
              "leftValue": "={{ $json.output[\"client name\"] }}",
              "rightValue": "",
              "operator": {
                "type": "string",
                "operation": "exists",
                "singleValue": true
              }
            }
          ],
          "combinator": "and"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.if",
      "typeVersion": 2.2,
      "position": [
        864,
        272
      ],
      "id": "3286b290-5ca0-4bd7-bfd1-32f4e9608199",
      "name": "If5"
    },
    {
      "parameters": {
        "mode": "combine",
        "combineBy": "combineAll",
        "options": {}
      },
      "type": "n8n-nodes-base.merge",
      "typeVersion": 3.2,
      "position": [
        640,
        272
      ],
      "id": "c09bab53-ac1d-452a-a3c5-9ffc9cca450b",
      "name": "Merge"
    },
    {
      "parameters": {
        "workflowId": {
          "__rl": true,
          "value": "WIHMBpRis9b20wAv",
          "mode": "list",
          "cachedResultName": "CIS Rag test"
        },
        "workflowInputs": {
          "mappingMode": "defineBelow",
          "value": {
            "client_name": "={{ $json.client_name }}",
            "date": "={{$json.date}}",
            "source_type": "={{$json.source_type}}",
            "content": "={{ $json.content }}"
          },
          "matchingColumns": [],
          "schema": [
            {
              "id": "client_name",
              "displayName": "client_name",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "canBeUsedToMatch": true,
              "type": "string",
              "removed": false
            },
            {
              "id": "date",
              "displayName": "date",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "canBeUsedToMatch": true,
              "type": "string",
              "removed": false
            },
            {
              "id": "source_type",
              "displayName": "source_type",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "canBeUsedToMatch": true,
              "type": "string",
              "removed": false
            },
            {
              "id": "content",
              "displayName": "content",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "canBeUsedToMatch": true,
              "type": "string",
              "removed": false
            }
          ],
          "attemptToConvertTypes": false,
          "convertFieldsToString": true
        },
        "options": {}
      },
      "type": "n8n-nodes-base.executeWorkflow",
      "typeVersion": 1.2,
      "position": [
        1312,
        640
      ],
      "id": "e09e7df0-09ad-41f0-83ea-a311fc19571f",
      "name": "Call 'rag'1"
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict",
            "version": 2
          },
          "conditions": [
            {
              "id": "cd3756c3-118f-47c8-a3bc-9379d082a700",
              "leftValue": "={{ $binary && Object.keys($binary).length > 0 }}",
              "rightValue": "",
              "operator": {
                "type": "boolean",
                "operation": "true",
                "singleValue": true
              }
            }
          ],
          "combinator": "and"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.if",
      "typeVersion": 2.2,
      "position": [
        -704,
        -80
      ],
      "id": "13b6503c-1274-4c54-8140-b211a6ade72b",
      "name": "contains file?"
    },
    {
      "parameters": {
        "content": "## Check if client exists",
        "height": 400,
        "width": 416,
        "color": 6
      },
      "type": "n8n-nodes-base.stickyNote",
      "position": [
        -368,
        80
      ],
      "typeVersion": 1,
      "id": "b5d1088d-95c2-4102-988a-29c4b523ce85",
      "name": "Sticky Note5"
    },
    {
      "parameters": {
        "content": "## Check if client exists",
        "height": 400,
        "width": 432,
        "color": 6
      },
      "type": "n8n-nodes-base.stickyNote",
      "position": [
        176,
        -320
      ],
      "typeVersion": 1,
      "id": "24a298b0-7aec-4636-8280-8700fbc3024e",
      "name": "Sticky Note6"
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict",
            "version": 2
          },
          "conditions": [
            {
              "id": "00a47de4-4399-4c0a-9226-ed84be42af3a",
              "leftValue": "={{ $json.output.valid }}",
              "rightValue": "",
              "operator": {
                "type": "boolean",
                "operation": "true",
                "singleValue": true
              }
            }
          ],
          "combinator": "and"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.if",
      "typeVersion": 2.2,
      "position": [
        0,
        752
      ],
      "id": "68e78ef7-7b99-4534-b315-60c0e6a2f55e",
      "name": "validity check"
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "dcd98d59-b25e-4c21-aae9-c023277711a8",
              "name": "client_name",
              "value": "={{ $('AI Agent4').item.json.output.client }}",
              "type": "string"
            },
            {
              "id": "4e2cc843-ce37-45f6-acbc-7fa5e96a43e0",
              "name": "content",
              "value": "={{ $('AI Agent4').item.json.output.cleaned_notes }}",
              "type": "string"
            },
            {
              "id": "ef7409a5-f10d-43c6-a00f-7d6a2d102e84",
              "name": "date",
              "value": "={{ $json.output.date }}",
              "type": "string"
            },
            {
              "id": "e3e7de45-4e60-484e-9f42-cdaa3253f9e8",
              "name": "source_type",
              "value": "={{ $('Edit Fields3').item.json.source_type }}",
              "type": "string"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        608,
        720
      ],
      "id": "e1e490be-f3ec-45ac-a6c3-0443007dc4bb",
      "name": "Format metadata"
    },
    {
      "parameters": {
        "operation": "get",
        "tableId": "clients",
        "filters": {
          "conditions": [
            {
              "keyName": "email",
              "keyValue": "={{ $json.output.to }}"
            }
          ]
        }
      },
      "type": "n8n-nodes-base.supabase",
      "typeVersion": 1,
      "position": [
        208,
        736
      ],
      "id": "7973e9da-d665-45f5-95a3-cd6081185753",
      "name": "Check client",
      "alwaysOutputData": true,
      "credentials": {
        "supabaseApi": {
          "id": "hh3dnHsjI82CZcfO",
          "name": "Unnamed credential Yo"
        }
      }
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "db045712-6f14-4269-95c4-3e8e8330383c",
              "name": "From",
              "value": "={{ $json.from.value[0].name }}",
              "type": "string"
            },
            {
              "id": "ef0fcd35-0dbb-44eb-b1bb-b93697bc0658",
              "name": "Subject",
              "value": "={{ $json.subject }}",
              "type": "string"
            },
            {
              "id": "cc6cf6cb-d160-44b0-903b-65209acc94f3",
              "name": "To",
              "value": "={{ $json.to.value[0].address }}",
              "type": "string"
            },
            {
              "id": "00d3b4a9-d888-4192-9e2a-4bab86bca6f4",
              "name": "internalDate",
              "value": "={{ $json.headers.date }}",
              "type": "string"
            },
            {
              "id": "78146ab9-5346-4889-a994-601a1c3947c6",
              "name": "source_type",
              "value": "meeting",
              "type": "string"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        -592,
        752
      ],
      "id": "f6478f90-79fb-4799-92b1-5061da0ba03e",
      "name": "Edit Fields3"
    },
    {
      "parameters": {
        "promptType": "define",
        "text": "=You are a strict text-cleaning assistant.\n\nTasks:\n1. **Verify sender & recipients**\n   ‚Ä¢ Confirm the email is from ‚ÄúFyxer AI Notetaker‚Äù.\n   ‚Ä¢ Return the recipient (the ‚ÄúTo‚Äù field) exactly as found (e.g., example@gmail.com).\n   ‚Ä¢ If the sender is not Fyxer AI Notetaker, return:\n        {\"valid\": false, \"reason\": \"Sender not Fyxer AI Notetaker\"} and stop.\n\n2. **Identify client**\n   ‚Ä¢ In the email body there is a line similar to:\n       \"Meeting between: name1 <email1> <> name2 <email2>\"\n     or a variation that may contain only names, only emails, or both.\n   ‚Ä¢ Determine which participant is **not** the recipient from the ‚ÄúTo‚Äù field.\n   ‚Ä¢ Return that participant‚Äôs name and/or email as the `client`.\n\n3. **Clean the meeting notes**\n   ‚Ä¢ Remove signatures, footers, extra spaces, and quoting marks,\n     but keep all actual meeting content unchanged.\n\nRules:\n‚Ä¢ Do not add summaries or new wording.\n‚Ä¢ Output a single JSON object with this structure:\n\n{\n  \"valid\": true,\n  \"from\": \"<sender email>\",\n  \"date\"; \"<meeting date and time in utc>\"\n  \"to\": \"<recipient email>\",\n  \"client\": \"<client name or email>\",\n  \"cleaned_notes\": \"<clean text>\"\n}\n\nInput email text:\n{{ $('Get fyxer notes').item.json.text }}\nFrom:{{ $json.From }}\nTo: {{ $json.To }}",
        "hasOutputParser": true,
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.agent",
      "typeVersion": 1.9,
      "position": [
        -352,
        752
      ],
      "id": "ccd3a46f-963b-4161-aba8-7e43db070643",
      "name": "AI Agent4"
    },
    {
      "parameters": {
        "model": {
          "__rl": true,
          "mode": "list",
          "value": "gpt-4o-mini"
        },
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.lmChatOpenAi",
      "typeVersion": 1.2,
      "position": [
        -368,
        976
      ],
      "id": "9437186d-1945-4e08-90fd-0a92262b4f7a",
      "name": "OpenAI Chat Model4",
      "credentials": {
        "openAiApi": {
          "id": "P97bW4SECej7SdA6",
          "name": "don't use this eric"
        }
      }
    },
    {
      "parameters": {
        "jsonSchemaExample": "{\n  \"valid\": true,\n  \"from\": \"<sender email>\",\n  \"to\": \"<sender email>\",\n  \"date\":\"<date>\",\n  \"client\": \"<client name or email>\",\n  \"cleaned_notes\": \"<clean text>\"\n}"
      },
      "type": "@n8n/n8n-nodes-langchain.outputParserStructured",
      "typeVersion": 1.3,
      "position": [
        -128,
        1008
      ],
      "id": "d4c37bcd-cf0b-4354-b378-4c7d60d98c67",
      "name": "Structured Output Parser3"
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict",
            "version": 2
          },
          "conditions": [
            {
              "id": "59d4b853-ee3b-4539-83fc-e3b0731dfe93",
              "leftValue": "={{ $json.isEmpty() }}",
              "rightValue": "",
              "operator": {
                "type": "boolean",
                "operation": "false",
                "singleValue": true
              }
            }
          ],
          "combinator": "and"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.if",
      "typeVersion": 2.2,
      "position": [
        368,
        736
      ],
      "id": "175c6c90-c644-472e-b549-68f5b18b3bde",
      "name": "If2"
    },
    {
      "parameters": {
        "pollTimes": {
          "item": [
            {
              "mode": "everyMinute"
            }
          ]
        },
        "simple": false,
        "filters": {
          "sender": "notetaker@fyxer.com"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.gmailTrigger",
      "typeVersion": 1.3,
      "position": [
        -2208,
        1216
      ],
      "id": "e7025f12-b513-46d1-98d9-27f50051e7de",
      "name": "Get fyxer notes",
      "credentials": {
        "gmailOAuth2": {
          "id": "YZJy04K90HmM6neC",
          "name": "yonatantesfaye30@gmail.com"
        }
      }
    },
    {
      "parameters": {
        "content": "## - Gets email from fyxer\n## - Extracts the metadata and message\n## - Summarizes it with gpt and also extracts the client name from the fyxer message\n## - Checks if its from fyxer then saves it",
        "height": 608,
        "width": 1712,
        "color": 6
      },
      "type": "n8n-nodes-base.stickyNote",
      "position": [
        -720,
        528
      ],
      "typeVersion": 1,
      "id": "c3705888-f279-453c-a9e3-707eef85d8ef",
      "name": "Sticky Note7"
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict",
            "version": 2
          },
          "conditions": [
            {
              "id": "4911072d-e338-464d-9145-2bdcfa49a751",
              "leftValue": "={{ $json.from.value[0].address }}",
              "rightValue": "notetaker@fyxer.com",
              "operator": {
                "type": "string",
                "operation": "notEquals"
              }
            }
          ],
          "combinator": "and"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.if",
      "typeVersion": 2.2,
      "position": [
        -1072,
        128
      ],
      "id": "d03e80bf-c8d8-4557-aa9d-c9ad14eb1ca3",
      "name": "Is not fyxer"
    },
    {
      "parameters": {
        "content": "## Clean text, generate metadata and send to rag",
        "height": 368,
        "width": 832,
        "color": 6
      },
      "type": "n8n-nodes-base.stickyNote",
      "position": [
        144,
        112
      ],
      "typeVersion": 1,
      "id": "d1664652-8e0d-488e-ab64-7c0acf450d67",
      "name": "Sticky Note8"
    },
    {
      "parameters": {
        "jsCode": "function parse(str) {\n  const match = str.match(/^(.*?)(?:\\s*<([^>]+)>)?$/);\n  return {\n    name: (match?.[1] || \"\").trim().replace(/^\"|\"$/g, \"\"),\n    email: match?.[2] || (match?.[1] || \"\").trim()\n  };\n}\n\nconst inputJson = $input.first().json;\n\nreturn [{\n  json: {\n    // keep the full original JSON\n    ...inputJson,\n\n    // add parsed sender\n    from: parse(inputJson.from?.text || \"\"),\n\n    // add parsed recipients\n    to: (inputJson.to?.text || \"\")\n          .split(',')\n          .map(t => parse(t.trim()))\n  }\n}];\n"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        4480,
        688
      ],
      "id": "8465266b-4d63-408b-82eb-4f9f3e7e58d6",
      "name": "separate name and email2"
    },
    {
      "parameters": {
        "options": {}
      },
      "type": "n8n-nodes-base.splitInBatches",
      "typeVersion": 3,
      "position": [
        4192,
        672
      ],
      "id": "5180324c-6a50-4f60-b7df-74b2ce8af40f",
      "name": "Loop Over Items1"
    },
    {
      "parameters": {
        "promptType": "define",
        "text": "=-----\n\n### Email Analysis and Client Identification ‚Äì Sender as Client\n\n### Email Details:\n\n  * **From**: `{{ $json.from.name }} <{{ $json.from.email }}>`\n  * **To**: `{{ JSON.stringify($json.to) }}`\n  * **Subject**: `{{ $json.subject || $('contains file?1').item.json.subject }}`\n  * **Content**: `{{ $json.text || $('contains file?1').item.json.text }}`\n\n-----\n\n### Instructions\n\n#### 1\\. Collect All Name Inputs\n\nExamine the following fields and text to find all possible names and companies:\n\n  * `from.name`, `from.email`\n  * All recipients (`to`, `cc`, `bcc`) names and emails\n  * Subject line\n  * The entire email body (plain text and HTML)\n  * Normalize any HTML to plain text.\n\n#### 2\\. Name & Company Extraction\n\n  * Use entity recognition to find all person and company names from the collected inputs.\n  * Gather every detected candidate into an array called `extracted_names`.\n\n-----\n\n### Output Rules\n\n**Always perform the following:**\n\n  * **`client_found`**: This must always be `true`.\n  * **`client_info`**: Set this using the sender's details.\n      * `name`: Use the value from `{{ $json.from.name }}`.\n      * `email`: Use the value from `{{ $json.from.email }}`.\n  * **`confidence`**: This must always be `100`.\n  * **`match_reason`**: Use the static text: \"Client is identified as the sender of the email.\"\n  * **`extracted_names`**: Populate this with the array of all names and companies detected in the \"Name & Company Extraction\" step.\n  * **`need_clarification`**: This must always be `false`.\n  * **`reply_email`**: This must always be `null`.\n\n-----\n\n### JSON Response Template:\n\n```json\n{\n  \"action\": \"parse\",\n  \"response\": {\n    \"output\": {\n      \"client_found\": true,\n      \"submitted_by\": \"the name that received the question\",\n      \"client_info\": {\n        \"name\": \"{{ $json.from.name }}\",\n        \"email\": \"{{ $json.from.email }}\"\n      },\n      \"confidence\": 100,\n      \"match_reason\": \"Client is identified as the sender of the email.\",\n      \"extracted_names\": [\"string\", \"string\"],\n      \"need_clarification\": false,\n      \"reply_email\": null\n    }\n  }\n}\n```",
        "hasOutputParser": true,
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.agent",
      "typeVersion": 2.2,
      "position": [
        4144,
        896
      ],
      "id": "90e57ab1-c3a2-415f-96ad-518833c8450e",
      "name": "AI Agent5"
    },
    {
      "parameters": {
        "model": {
          "__rl": true,
          "mode": "list",
          "value": "gpt-4.1-mini"
        },
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.lmChatOpenAi",
      "typeVersion": 1.2,
      "position": [
        4080,
        1024
      ],
      "id": "5ebf9138-29d7-47f3-a832-4807fb544979",
      "name": "OpenAI Chat Model5",
      "credentials": {
        "openAiApi": {
          "id": "P97bW4SECej7SdA6",
          "name": "don't use this eric"
        }
      }
    },
    {
      "parameters": {
        "description": "Query database schema to understand table structures and relationships. Use this to discover client-related tables, their columns, and data types. Essential for understanding how client data is organized before performing searches.",
        "workflowId": {
          "__rl": true,
          "value": "zlGesc01ti3bPHEC",
          "mode": "id"
        },
        "workflowInputs": {
          "mappingMode": "defineBelow",
          "value": {},
          "matchingColumns": [],
          "schema": [],
          "attemptToConvertTypes": false,
          "convertFieldsToString": false
        }
      },
      "type": "@n8n/n8n-nodes-langchain.toolWorkflow",
      "typeVersion": 2.2,
      "position": [
        4384,
        1168
      ],
      "id": "a2032509-e2c6-4d1a-b5a9-d4c7878af497",
      "name": "database_schema_query2"
    },
    {
      "parameters": {
        "operation": "executeQuery",
        "query": "{{ $fromAI(\"sqlquery\") }}",
        "options": {}
      },
      "type": "n8n-nodes-base.postgresTool",
      "typeVersion": 2.6,
      "position": [
        4256,
        1104
      ],
      "id": "7eb746c8-c4cc-4919-9e99-eaee1420a8b2",
      "name": "client_search_query2",
      "rewireOutputLogTo": "ai_tool",
      "credentials": {
        "postgres": {
          "id": "o7CV6wApz7ITDXSi",
          "name": "Unnamed credential"
        }
      }
    },
    {
      "parameters": {
        "sessionIdType": "customKey",
        "sessionKey": "={{ $json.threadId }}"
      },
      "type": "@n8n/n8n-nodes-langchain.memoryBufferWindow",
      "typeVersion": 1.3,
      "position": [
        4128,
        1104
      ],
      "id": "23b9db8b-4a1a-46cb-9202-b3d8de14f4ea",
      "name": "Simple Memory2"
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict",
            "version": 2
          },
          "conditions": [
            {
              "id": "bbe33f8c-986c-452c-9994-bc9ecc54424e",
              "leftValue": "={{ $json.response.output.client_found }}",
              "rightValue": "",
              "operator": {
                "type": "boolean",
                "operation": "true",
                "singleValue": true
              }
            }
          ],
          "combinator": "and"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.if",
      "typeVersion": 2.2,
      "position": [
        4608,
        896
      ],
      "id": "5ff28d9f-ed6e-472b-8c87-78c7da42ce5d",
      "name": "Client Found?"
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "db045712-6f14-4269-95c4-3e8e8330383c",
              "name": "From",
              "value": "={{ $json.headers.from }}",
              "type": "string"
            },
            {
              "id": "ef0fcd35-0dbb-44eb-b1bb-b93697bc0658",
              "name": "Subject",
              "value": "={{ $json.headers.subject }}",
              "type": "string"
            },
            {
              "id": "cc6cf6cb-d160-44b0-903b-65209acc94f3",
              "name": "To",
              "value": "={{ $json.headers.to }}",
              "type": "string"
            },
            {
              "id": "00d3b4a9-d888-4192-9e2a-4bab86bca6f4",
              "name": "internalDate",
              "value": "={{ $json.headers.date }}",
              "type": "string"
            },
            {
              "id": "06d49d99-f657-40fa-91e1-a6caed41d875",
              "name": "snippet",
              "value": "={{ $json.text }}",
              "type": "string"
            },
            {
              "id": "78146ab9-5346-4889-a994-601a1c3947c6",
              "name": "source_type",
              "value": "=email",
              "type": "string"
            },
            {
              "id": "7d3c3936-27b7-45cb-aa1e-9641a8507ad3",
              "name": "client",
              "value": "={{ $('client checker output').item.json.response.output.client_info.name }}",
              "type": "string"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        4192,
        1536
      ],
      "id": "61d0a5c3-ab5c-4b6f-94a2-6d98281525c6",
      "name": "Edit Fields4"
    },
    {
      "parameters": {
        "jsonSchemaExample": "{\n\t\"content\": \"content\",\n    \"date\":\"date\",\n  \"explanation\": \"<one-sentence detailed explanation>\"\n}"
      },
      "type": "@n8n/n8n-nodes-langchain.outputParserStructured",
      "typeVersion": 1.3,
      "position": [
        4624,
        1792
      ],
      "id": "bea8e9d9-2f98-40ed-adba-17398dbcfc3a",
      "name": "Structured Output Parser4"
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "65322511-d1fc-4106-a7ba-f8dbe5f16167",
              "name": "client_name",
              "value": "={{ $('client checker output').item.json.response.output.client_info.name }}",
              "type": "string"
            },
            {
              "id": "ba1bfb90-4f84-43ea-bc00-fe0982f46349",
              "name": "content",
              "value": "={{ $('Edit Fields4').item.json.Subject }}. \ncontent:{{ $json.output.content }}.\nexplanation: {{ $json.output.explanation }}.",
              "type": "string"
            },
            {
              "id": "f7f5b514-2759-4350-93dd-5862120b9154",
              "name": "date",
              "value": "={{ $json.output.date }}",
              "type": "string"
            },
            {
              "id": "34f372f5-10c6-442f-8eca-800e7cef2baf",
              "name": "source_type",
              "value": "={{ $('Edit Fields4').item.json.source_type }}",
              "type": "string"
            },
            {
              "id": "8a3d0825-5fae-4a17-b0a1-de6169a9d787",
              "name": "perspective",
              "value": "external",
              "type": "string"
            },
            {
              "id": "9c8db1d7-4d0e-40ba-8672-d273a1950c76",
              "name": "submitted_by",
              "value": "={{ $('client checker output').item.json.response.output.submitted_by }}",
              "type": "string"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        4752,
        1536
      ],
      "id": "b4f95254-951a-4bf1-80b0-d838fe92247b",
      "name": "Edit Fields5"
    },
    {
      "parameters": {
        "workflowId": {
          "__rl": true,
          "value": "tROKogZ9MfAJKMDm",
          "mode": "list",
          "cachedResultName": "rag"
        },
        "workflowInputs": {
          "mappingMode": "defineBelow",
          "value": {},
          "matchingColumns": [],
          "schema": [],
          "attemptToConvertTypes": false,
          "convertFieldsToString": true
        },
        "options": {}
      },
      "type": "n8n-nodes-base.executeWorkflow",
      "typeVersion": 1.2,
      "position": [
        5008,
        1536
      ],
      "id": "438e04c5-745a-415b-bdba-430b0c8c25ab",
      "name": "Call 'rag'2"
    },
    {
      "parameters": {
        "jsCode": "// Helper function to parse \"Name <email@example.com>\" strings\nfunction parse(str) {\n    if (!str) return { name: \"\", email: \"\" };\n    const match = str.match(/^(.*?)(?:\\s*<([^>]+)>)?$/);\n    return {\n        name: (match[1] || \"\").trim().replace(/^\"|\"$/g, \"\"),\n        email: match[2] || (match[1] || \"\").trim()\n    };\n}\n\n// Get the first incoming item\nconst item = $input.first();\n\n// Return the modified JSON while keeping binary intact\nreturn [{\n    json: { \n      threadId: $input.first().json.threadId,// keep all original json fields\n        from: parse(item.json.from?.text),\n        to: (item.json.to?.text || \"\")\n              .split(',')\n              .map(t => parse(t.trim()))\n    },\n    binary: item.binary // preserve all original binary data\n}];\n"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        4800,
        688
      ],
      "id": "e8620e96-2791-4357-ae7b-be452d3e6b43",
      "name": "separate name and send file"
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "1249ac1d-f62f-4c87-b20b-2bd364967aa8",
              "name": "source_type",
              "value": "email_with_file",
              "type": "string"
            },
            {
              "id": "9b452cf6-d268-4ed5-98ed-59b701a8b117",
              "name": "client_name",
              "value": "={{ $('client checker output').item.json.response.output.client_info.name }}",
              "type": "string"
            },
            {
              "id": "46b51ef8-b4ee-4fa6-9747-e4f7d66c1bf8",
              "name": "content",
              "value": "= {{ $('contains file?1').item.json.subject }} Body: {{ $('contains file?1').item.json.text }}",
              "type": "string"
            },
            {
              "id": "ad5c3df9-427b-46ba-a858-df2a66aeddc3",
              "name": "date",
              "value": "={{ $('contains file?1').item.json.date }}",
              "type": "string"
            },
            {
              "id": "86158365-4597-4d97-8f48-9128f2474d5b",
              "name": "perspective",
              "value": "external",
              "type": "string"
            },
            {
              "id": "358b033e-15a2-452d-9e80-5ae1da0b9682",
              "name": "submitted_by",
              "value": "={{ $('client checker output').item.json.response.output.submitted_by }}",
              "type": "string"
            }
          ]
        },
        "includeOtherFields": true,
        "options": {}
      },
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        4752,
        1312
      ],
      "id": "33069d46-9fa2-47dd-8db5-84e6174d8d56",
      "name": "Edit Fields6"
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict",
            "version": 2
          },
          "conditions": [
            {
              "id": "cd3756c3-118f-47c8-a3bc-9379d082a700",
              "leftValue": "={{ $binary && Object.keys($binary).length > 0 }}",
              "rightValue": "",
              "operator": {
                "type": "boolean",
                "operation": "true",
                "singleValue": true
              }
            }
          ],
          "combinator": "and"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.if",
      "typeVersion": 2.2,
      "position": [
        4464,
        448
      ],
      "id": "ec99467b-4341-4487-8609-14b030d32d74",
      "name": "contains file?1"
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict",
            "version": 2
          },
          "conditions": [
            {
              "id": "94aac8ef-2155-41be-8ad5-c08208f31407",
              "leftValue": "={{ $binary && Object.keys($binary).length > 0 }}",
              "rightValue": "",
              "operator": {
                "type": "boolean",
                "operation": "true",
                "singleValue": true
              }
            }
          ],
          "combinator": "and"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.if",
      "typeVersion": 2.2,
      "position": [
        4384,
        1328
      ],
      "id": "4f974bc3-41ac-4219-a5a4-78b157ea9430",
      "name": "has file?"
    },
    {
      "parameters": {
        "mode": "combine",
        "combineBy": "combineAll",
        "options": {}
      },
      "type": "n8n-nodes-base.merge",
      "typeVersion": 3.2,
      "position": [
        4192,
        1328
      ],
      "id": "e65922a9-3821-43b7-9000-b1485ea5af72",
      "name": "Merge2"
    },
    {
      "parameters": {
        "workflowId": {
          "__rl": true,
          "value": "kVD6Qjide0ZNhZkk",
          "mode": "list",
          "cachedResultName": "Tabular data test"
        },
        "workflowInputs": {
          "mappingMode": "defineBelow",
          "value": {},
          "matchingColumns": [],
          "schema": [],
          "attemptToConvertTypes": false,
          "convertFieldsToString": true
        },
        "options": {}
      },
      "type": "n8n-nodes-base.executeWorkflow",
      "typeVersion": 1.2,
      "position": [
        5008,
        1312
      ],
      "id": "b3e2ece2-de97-4241-8964-291bc3dd7733",
      "name": "Call 'rag'3"
    },
    {
      "parameters": {
        "jsCode": "// Get the AI node output (which is a string)\nconst rawOutput = $json.output || $json.text || \"{}\";\n\n// Clean the string to remove markdown code fences (e.g., ```json)\nconst cleanedJsonString = rawOutput\n  .replace(/^```json\\s*/, '')\n  .replace(/\\s*```$/, '');\n\nlet parsed;\n\ntry {\n  // Try to parse the cleaned string\n  parsed = JSON.parse(cleanedJsonString);\n} catch (err) {\n  // If parsing fails, create a default error object\n  parsed = {\n    action: \"parse\",\n    response: {\n      output: {\n        client_found: false,\n        submitted_by: null,\n        client_info: { name: null, email: null },\n        confidence: 0,\n        match_reason: \"Failed to parse AI output after cleaning.\",\n        need_clarification: true,\n        reply_email: { to: \"\", subject: \"\", body: \"\" }\n      }\n    }\n  };\n}\n\n// Ensure submitted_by exists even if the AI's JSON is valid but missing the key\nif (parsed && parsed.response && parsed.response.output && !('submitted_by' in parsed.response.output)) {\n  parsed.response.output.submitted_by = null;\n}\n\n// Return the final, correctly parsed JSON object\nreturn [{ json: parsed }];"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        4448,
        896
      ],
      "id": "60b619e0-97fb-4282-99e6-0e0a44b66361",
      "name": "client checker output"
    },
    {
      "parameters": {
        "operation": "reply",
        "messageId": "={{ $('Gmail Trigger2').item.json.threadId }}",
        "emailType": "text",
        "message": "={{ $json.response.output.reply_email.body }}",
        "options": {
          "appendAttribution": false
        }
      },
      "type": "n8n-nodes-base.gmail",
      "typeVersion": 2.1,
      "position": [
        4832,
        912
      ],
      "id": "b24a4e99-2173-4157-814b-caad7d61dcc7",
      "name": "Reply to a message",
      "webhookId": "beaddba0-bc3d-4226-8253-f9a660caf26e",
      "credentials": {
        "gmailOAuth2": {
          "id": "U9j5tOtd70hTCiq3",
          "name": "kefe"
        }
      }
    },
    {
      "parameters": {
        "pollTimes": {
          "item": [
            {
              "mode": "everyMinute"
            }
          ]
        },
        "simple": false,
        "filters": {},
        "options": {
          "downloadAttachments": true
        }
      },
      "type": "n8n-nodes-base.gmailTrigger",
      "typeVersion": 1.2,
      "position": [
        4192,
        448
      ],
      "id": "a5423bb6-b68c-412f-9103-18ef856dbf8e",
      "name": "Gmail Trigger2",
      "credentials": {
        "gmailOAuth2": {
          "id": "U9j5tOtd70hTCiq3",
          "name": "kefe"
        }
      }
    },
    {
      "parameters": {
        "promptType": "define",
        "text": "=You are a strict text-cleaning assistant.\n\nTasks\n\nClean the email text\n\nRemove signatures, footers, quoted replies, and extra spaces.\n\nKeep all actual message content exactly as written‚Äîno rephrasing or summarizing.\n\nAppend a detailed explanation\n\nAfter the cleaned email text, add\nexplanation: <one-sentence summary>\nwhere the summary states who the email is from/to and its main purpose.\n\nRules\n\nDo not invent information not found in the email.\n\nDate must be in UTC.\n\nOutput a single JSON object in this exact structure:\n\n{\n  \"date\": \"<UTC date from internalDate>\",\n  \"content\": \"<cleaned email text>\",\nexplanation: \"<one-sentence detailed explanation>\"\n}\n\n\nInput email text:{{ JSON.stringify($json) }}\n\n",
        "hasOutputParser": true,
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.agent",
      "typeVersion": 1.9,
      "position": [
        4416,
        1536
      ],
      "id": "a7df6832-6a41-40a8-b6d7-c8b840c803b8",
      "name": "AI Agent6"
    },
    {
      "parameters": {
        "model": {
          "__rl": true,
          "mode": "list",
          "value": "gpt-4o-mini"
        },
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.lmChatOpenAi",
      "typeVersion": 1.2,
      "position": [
        4432,
        1792
      ],
      "id": "e30ef1aa-7c71-4706-92bd-f88d8b6a33f6",
      "name": "OpenAI Chat Model6",
      "credentials": {
        "openAiApi": {
          "id": "P97bW4SECej7SdA6",
          "name": "don't use this eric"
        }
      }
    },
    {
      "parameters": {
        "content": "## CHANGED FOR TESTING",
        "height": 80,
        "width": 320
      },
      "type": "n8n-nodes-base.stickyNote",
      "position": [
        3776,
        896
      ],
      "typeVersion": 1,
      "id": "e8622d7a-2646-4c1c-84bc-0d1a80a61a97",
      "name": "Sticky Note9"
    },
    {
      "parameters": {
        "description": "Query database schema to understand table structures and relationships. Use this to discover client-related tables, their columns, and data types. Essential for understanding how client data is organized before performing searches.",
        "workflowId": {
          "__rl": true,
          "value": "zlGesc01ti3bPHEC",
          "mode": "id"
        },
        "workflowInputs": {
          "mappingMode": "defineBelow",
          "value": {},
          "matchingColumns": [],
          "schema": [],
          "attemptToConvertTypes": false,
          "convertFieldsToString": false
        }
      },
      "type": "@n8n/n8n-nodes-langchain.toolWorkflow",
      "typeVersion": 2.2,
      "position": [
        7696,
        1904
      ],
      "id": "001de498-1d5b-46d2-ac22-08d3671979d9",
      "name": "database_schema_query4"
    },
    {
      "parameters": {
        "operation": "executeQuery",
        "query": "{{ $fromAI(\"sqlquery\") }}",
        "options": {}
      },
      "type": "n8n-nodes-base.postgresTool",
      "typeVersion": 2.6,
      "position": [
        7584,
        1888
      ],
      "id": "6be26b99-06ca-4027-8916-799864adfdf7",
      "name": "client_search_query4",
      "rewireOutputLogTo": "ai_tool",
      "credentials": {
        "postgres": {
          "id": "cA6Eku8jQefKVBV0",
          "name": "yordi cis"
        }
      }
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "34667669-1741-46ab-b9d1-ddb03aaaa73e",
              "name": "client_name",
              "value": "={{ $json.output.client_name }}",
              "type": "string"
            },
            {
              "id": "82dfe45b-4245-4e71-b339-dc569aecf6a2",
              "name": "date",
              "value": "={{ $json.output.date }}",
              "type": "string"
            },
            {
              "id": "6459c458-f956-494a-827b-9599b7644139",
              "name": "date",
              "value": "={{ $json.output.date }}",
              "type": "string"
            },
            {
              "id": "3d59acb1-97a5-4c67-9973-c8fcf0582dcb",
              "name": "content",
              "value": "={{ $json.output.meeting_summary }}",
              "type": "string"
            },
            {
              "id": "f30bfbf8-2e4f-4279-b6e0-a728f29270ea",
              "name": "perspective",
              "value": "internal",
              "type": "string"
            },
            {
              "id": "a39da13c-4883-41f7-aba0-354cbc2e3854",
              "name": "source_type",
              "value": "meeting",
              "type": "string"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        8112,
        1648
      ],
      "id": "ff140124-752e-4308-a54f-8ee2932b54bd",
      "name": "Set metadata"
    },
    {
      "parameters": {
        "workflowId": {
          "__rl": true,
          "value": "tROKogZ9MfAJKMDm",
          "mode": "list",
          "cachedResultName": "rag"
        },
        "workflowInputs": {
          "mappingMode": "defineBelow",
          "value": {},
          "matchingColumns": [],
          "schema": [],
          "attemptToConvertTypes": false,
          "convertFieldsToString": true
        },
        "options": {}
      },
      "type": "n8n-nodes-base.executeWorkflow",
      "typeVersion": 1.2,
      "position": [
        8320,
        1648
      ],
      "id": "85574e23-7f38-4bd1-8151-5ff2202423b4",
      "name": "Call 'rag'4"
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict",
            "version": 2
          },
          "conditions": [
            {
              "id": "0c2bf70b-e077-439e-8e0f-38f9f69895ed",
              "leftValue": "={{ $json.output.is_meeting_note }}",
              "rightValue": "",
              "operator": {
                "type": "boolean",
                "operation": "true",
                "singleValue": true
              }
            },
            {
              "id": "14b1d41f-a320-4459-9765-3b0bf5a48e48",
              "leftValue": "={{ $json.output.client_found }}",
              "rightValue": "",
              "operator": {
                "type": "boolean",
                "operation": "true",
                "singleValue": true
              }
            }
          ],
          "combinator": "and"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.if",
      "typeVersion": 2.2,
      "position": [
        7840,
        1664
      ],
      "id": "e95edd3e-7ee6-45b8-8305-99002501afa0",
      "name": "is client and meeting note?"
    },
    {
      "parameters": {
        "content": "1. **Send Meeting Info to Agent**  \n   - Forward the full meeting details to the AI agent.  \n   - The agent generates a **comprehensive summary** of the meeting.  \n   - The agent also:  \n     - Verifies if the **client exists**.  \n     - Confirms whether it was an **actual meeting** (vs. test/placeholder).  \n\n2. **Metadata Extraction**  \n   - The **Edit node** parses the agent‚Äôs output.  \n   - Extracts and sets the necessary metadata fields (e.g., `date`, `client_name`, `source_type`, etc.).  \n\n3. **Send to RAG**  \n   - Store the cleaned summary + metadata in the **RAG Workflow**.\n",
        "height": 752,
        "width": 1200,
        "color": 4
      },
      "type": "n8n-nodes-base.stickyNote",
      "position": [
        7440,
        1344
      ],
      "typeVersion": 1,
      "id": "94e91e88-3121-4321-b090-58e1af2aff16",
      "name": "Sticky Note13"
    },
    {
      "parameters": {
        "content": "## üìå Workflow Step: Fireflies Meeting Handling\n\n1. **Webhook Trigger**  \n   - After a meeting ends in **Fireflies**, the platform generates the transcript.  \n   - Fireflies then calls this **Webhook**, passing the event data.  \n\n2. **Fetch Latest Transcript**  \n   - The **second Fireflies node** retrieves the most recent transcript from the meeting.  \n\n3. **Fetch Full Meeting Data**  \n   - The **third Fireflies node** pulls the **complete meeting details** along with the full transcript information by using the id sent from previous(fetch latest transcript) node.  \n",
        "height": 752,
        "width": 608,
        "color": 5
      },
      "type": "n8n-nodes-base.stickyNote",
      "position": [
        6816,
        1344
      ],
      "typeVersion": 1,
      "id": "01e1f15a-ae9a-4b19-9975-53b459b8c60d",
      "name": "Sticky Note14"
    },
    {
      "parameters": {
        "transcriptId": "={{ $json.data.id }}"
      },
      "type": "@firefliesai/n8n-nodes-fireflies.fireflies",
      "typeVersion": 1,
      "position": [
        7280,
        1664
      ],
      "id": "abe1816f-fb8d-467a-af81-e191f0fbd786",
      "name": "Get Full Meeting Data"
    },
    {
      "parameters": {
        "operation": "getTranscriptsList",
        "limit": 1,
        "filters": {}
      },
      "type": "@firefliesai/n8n-nodes-fireflies.fireflies",
      "typeVersion": 1,
      "position": [
        7072,
        1664
      ],
      "id": "1f582830-7d5d-4c3b-82e4-d2cabffe3b08",
      "name": "Get Latest Transcript"
    },
    {
      "parameters": {
        "httpMethod": "POST",
        "path": "94cb2d5d-6592-436a-b092-31c71e2f9914",
        "options": {
          "responseHeaders": {
            "entries": [
              {
                "name": "x-hub-signature",
                "value": "25351f94f9864342962efdb4b15218"
              }
            ]
          }
        }
      },
      "type": "n8n-nodes-base.webhook",
      "typeVersion": 2.1,
      "position": [
        6864,
        1664
      ],
      "id": "5d4bf273-1501-49d6-b42e-397b2240653a",
      "name": "Webhook2",
      "webhookId": "94cb2d5d-6592-436a-b092-31c71e2f9914"
    },
    {
      "parameters": {
        "promptType": "define",
        "text": "=Your task is to extract meeting notes and check if one of the participant is a client(from database).\nmeeting summary: make sure it is a descriptive summary including a between whom it was.\nis meeting note: if there are no participants then it isn't a meeting note\n\noutput json:\noutput: {\n  is_meeting_note:<true | false>\n  client_found: <false | true>\n  client_name:\"<client name>\"\n  meeting_summary:\"\"\n  date:\"meeting date and time in utc || now if unavailable\"\n}\nparticipants: {{ $('Get Latest Transcript').item.json.data.participants }}\nhere is all the info you need: {{ $json.data.toJsonString() }}",
        "hasOutputParser": true,
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.agent",
      "typeVersion": 2.2,
      "position": [
        7488,
        1664
      ],
      "id": "ad370bdf-0efd-41ad-8a72-0fc3931caa5e",
      "name": "AI Agent8"
    },
    {
      "parameters": {
        "model": {
          "__rl": true,
          "mode": "list",
          "value": "gpt-4.1-mini"
        },
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.lmChatOpenAi",
      "typeVersion": 1.2,
      "position": [
        7488,
        1888
      ],
      "id": "a9c078d1-8686-4f82-af82-4b080b612b01",
      "name": "OpenAI Chat Model8"
    },
    {
      "parameters": {
        "jsonSchemaExample": "{\n  \"is_meeting_note\":true,\n  \"client_found\":false,\n  \"client_name\":\"<client name>\",\n  \"date\":\"meeting date and time in utc || now if unavailable\",\n  \"meeting_summary\":\"\"\n}"
      },
      "type": "@n8n/n8n-nodes-langchain.outputParserStructured",
      "typeVersion": 1.3,
      "position": [
        7808,
        1904
      ],
      "id": "4b6bcf8e-c3b7-4dd0-991c-6a5569a397e9",
      "name": "Structured Output Parser6"
    },
    {
      "parameters": {
        "options": {
          "timezone": ""
        }
      },
      "type": "n8n-nodes-base.dateTimeTool",
      "typeVersion": 2,
      "position": [
        1584,
        2672
      ],
      "id": "e7e1a072-936e-40e4-8a64-60d975ef3ca0",
      "name": "Date & Time Tool",
      "description": "Get current date and time information"
    },
    {
      "parameters": {
        "promptType": "define",
        "text": "={{ $json.chatInput }}",
        "options": {
          "systemMessage": "here is the prompt: You are a Client Intelligence System Agent.\nYour role is to provide accurate, structured summaries of client-related information using Postgres (for client verification) and Supabase (for content). Always sound professional, concise, and factual. Ignore previous conversations.\n\nTOOLS\n\nPostgres\n\ncheck_client_existence(name: str) ‚Üí bool\n\nMust always be called for client-specific queries.\n\nUse the workflow-provided query as-is.\n\nIf the client does not exist, reply:\n\n‚ÄúI couldn‚Äôt find a client named <client_name> in the directory.‚Äù\n\nSupabase\n\nIf user question has a client_name, source type(slack, email, meeting...) or date, use the \"client data\" tool. If multiple clients,sourcetype or date were mentioned, query them individually and combine data.\n\nIf the question involves content or a keyword that can be searched use the supabase tool\nOnly retrieve chunks where:\n\nclient_name exactly matches the verified client\n\nsource_type matches the requested source\n\ncontent is not empty or trivial\n\nDo not discard valid chunks based on semantic rank.\n\nAfter retrieval, ignore trivial content or empty messages.\n\nDatetime\n\nget_current_datetime() ‚Üí str: format timestamps in the user‚Äôs local timezone.\nwhen querying use a json structure and use UTC: \n**important, exact query to client data should look like this:\n{\n  \"metadata_name1\": \"source_type\",\n  \"value1\": \"<source_type or ''>\",\n  \"metadata_name2\": \"client_name\",\n  \"value2\": \"<client_name or ''>\",\n  \"metadata_name3\": \"date\",\n  \"value3\": \"<UTC date or ''>\"\n}\nRules for Supabase metadata query:\n\nAlways include all three metadata name/value pairs ‚Äî never omit them.\n\nIf a value is not detected in the user query, leave it as an empty string (\"\").\n\nWORKFLOW LOGIC\n\nClient-Specific Requests\n\nParse user query to extract client_name and optional source_type.\n\nVerify client existence via Postgres.\n\nBuild the Supabase search_query dynamically according to the rules above.\n\nFetch Supabase results.\n\nFilter out trivial content (<20 characters, empty, or single words).\n\nMerge, deduplicate, and sort by semantic relevance then date.\n\nSummarize in structured format (e.g., Discussions, Major Topics, Errors/Tasks).\n\nIf no valid chunks remain ‚Üí reply:\n\n‚ÄúThe available data for <client_name>‚Äôs <source_type> activity is incomplete. All retrieved entries contain only trivial content or metadata.‚Äù\n\nGeneral Requests (no client name)\n\nDo not use Postgres.\n\nSummarize across clients, applying strict filters: valid client names only, content not empty, source_type if specified.\n\nOUTPUT FORMAT\n\nTitle: <Source> Activity Summary ‚Äì <Client Name>\n\nSections: Discussions, Major Topics, Errors/Tasks.\n\nInclude representative messages in quotes.\n\nInclude metadata (date, file_name) if helpful.\n\nMarkdown formatting, limit 10 items per section, hide empty/repeated sections.\n\nFull raw content only if requested.\n\nAnswer general questions without requiring client names eg. weekly summary filter it by comparing to the current date\n\nIf no data was found from tools let the user know and politely ask the user for more info like client name and source(slack, email or meeting) don't answer without data backing.\n"
        }
      },
      "type": "@n8n/n8n-nodes-langchain.agent",
      "typeVersion": 2.2,
      "position": [
        1248,
        2368
      ],
      "id": "96bae59f-ddd3-4477-b37f-4794d6b260f2",
      "name": "Client Intelligence Agent"
    },
    {
      "parameters": {
        "sessionIdType": "customKey",
        "sessionKey": "={{ $json.user_id || $json.chat_id || 'default-session' }}"
      },
      "type": "@n8n/n8n-nodes-langchain.memoryBufferWindow",
      "typeVersion": 1.3,
      "position": [
        1344,
        2560
      ],
      "id": "38de5eea-fbf9-42cb-a71f-7a798f0db0bc",
      "name": "conversational memory"
    },
    {
      "parameters": {
        "toolDescription": "Here is all the data about the clients, search clients by name or email and get every available data about them",
        "method": "POST",
        "url": "https://supabase.accelerategtm.net/functions/v1/hybrid-search",
        "sendHeaders": true,
        "headerParameters": {
          "parameters": [
            {
              "name": "Authorization",
              "value": "Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJyb2xlIjoiYW5vbiIsImlzcyI6InN1cGFiYXNlIiwiaWF0IjoxNzU3Nzk3MjAwLCJleHAiOjE5MTU1NjM2MDB9.F1jWX6vTMDT0MCuu_vOAL5Rjw4mDWxo3WcQ1HQ_XAEM"
            },
            {
              "name": "Content-Type",
              "value": "application/json"
            }
          ]
        },
        "sendBody": true,
        "bodyParameters": {
          "parameters": [
            {
              "name": "query",
              "value": "={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('parameters0_Value', ``, 'string') }}"
            }
          ]
        },
        "options": {
          "response": {
            "response": {
              "neverError": true,
              "responseFormat": "json"
            }
          }
        }
      },
      "type": "n8n-nodes-base.httpRequestTool",
      "typeVersion": 4.2,
      "position": [
        1888,
        2688
      ],
      "id": "f602317a-4dfc-49f2-aa8d-27f5836b1b7b",
      "name": "Supabase Search",
      "description": "Search the Supabase database for client intelligence data"
    },
    {
      "parameters": {
        "description": "get client info by client name and source type",
        "workflowId": {
          "__rl": true,
          "value": "fSq0zTuMFzJHxE42",
          "mode": "list",
          "cachedResultName": "Chat Interface"
        },
        "workflowInputs": {
          "mappingMode": "defineBelow",
          "value": {
            "query": "={{ $fromAI('query') }}"
          },
          "matchingColumns": [
            "query"
          ],
          "schema": [
            {
              "id": "query",
              "displayName": "query",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "canBeUsedToMatch": true,
              "type": "string",
              "removed": false
            }
          ],
          "attemptToConvertTypes": false,
          "convertFieldsToString": false
        }
      },
      "type": "@n8n/n8n-nodes-langchain.toolWorkflow",
      "typeVersion": 2.2,
      "position": [
        1712,
        2720
      ],
      "id": "60606b03-3fa7-4d99-b15b-bcc5c1d67226",
      "name": "Client data"
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "0eedfe7f-9305-4a84-a3d4-4b905d255993",
              "name": "chatInput",
              "value": "={{ $json.body.chatInput }}",
              "type": "string"
            },
            {
              "id": "15c94723-8445-4688-b116-9aafc6830f66",
              "name": "systemPrompt",
              "value": "={{ $json.body.systemPrompt }}",
              "type": "string"
            },
            {
              "id": "ee42f7a1-57d7-4023-b0bd-acd1f88109c5",
              "name": "user_id",
              "value": "={{ $json.body.user_id }}",
              "type": "string"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        976,
        2432
      ],
      "id": "0c2ed99c-0068-467a-b33b-66ac5d68615a",
      "name": "Edit Fields7"
    },
    {
      "parameters": {
        "httpMethod": "POST",
        "path": "5d3d89f9-c8b4-4b13-8a69-54ee3f6332a2",
        "authentication": "headerAuth",
        "responseMode": "lastNode",
        "options": {}
      },
      "type": "n8n-nodes-base.webhook",
      "typeVersion": 2.1,
      "position": [
        640,
        2544
      ],
      "id": "bf6183c9-828f-4a92-a3e6-d0aeed8adb2a",
      "name": "Webhook1",
      "webhookId": "5d3d89f9-c8b4-4b13-8a69-54ee3f6332a2"
    },
    {
      "parameters": {
        "model": {
          "__rl": true,
          "value": "gpt-4.1",
          "mode": "list",
          "cachedResultName": "gpt-4.1"
        },
        "options": {
          "temperature": 0.4
        }
      },
      "type": "@n8n/n8n-nodes-langchain.lmChatOpenAi",
      "typeVersion": 1.2,
      "position": [
        1248,
        2496
      ],
      "id": "aa295018-7c06-4ff7-b052-3f4fe7aab1dc",
      "name": "OpenAI Chat Model7",
      "credentials": {
        "openAiApi": {
          "id": "P97bW4SECej7SdA6",
          "name": "don't use this eric"
        }
      }
    },
    {
      "parameters": {
        "descriptionType": "manual",
        "toolDescription": "Search name to search for the clients name from the clients table.",
        "operation": "executeQuery",
        "query": "{{ $fromAI(\"sqlquery\") }}",
        "options": {}
      },
      "type": "n8n-nodes-base.postgresTool",
      "typeVersion": 2.6,
      "position": [
        1456,
        2608
      ],
      "id": "25ed0a4c-ca6d-4447-a60b-774124b78f8a",
      "name": "client_search_query",
      "rewireOutputLogTo": "ai_tool",
      "credentials": {
        "postgres": {
          "id": "cA6Eku8jQefKVBV0",
          "name": "yordi cis"
        }
      }
    },
    {
      "parameters": {
        "workflowInputs": {
          "values": [
            {
              "name": "query"
            }
          ]
        }
      },
      "type": "n8n-nodes-base.executeWorkflowTrigger",
      "typeVersion": 1.1,
      "position": [
        1056,
        3104
      ],
      "id": "b93d3840-445b-4c27-8468-7fca24aa474b",
      "name": "When Executed by Another Workflow"
    },
    {
      "parameters": {
        "promptType": "define",
        "text": "={{ $json.query }}",
        "options": {
          "systemMessage": "=Call the 1 filter node if query only contains 1 value, call 2 filters node if there are 2 values and call 3 filters if there are 3 values.\nreturn every single information in a well formatted manner without additional commentary"
        }
      },
      "type": "@n8n/n8n-nodes-langchain.agent",
      "typeVersion": 2.2,
      "position": [
        1264,
        3104
      ],
      "id": "c92ea3dc-b788-4f05-83a3-5ab857f252e4",
      "name": "Get client info by name and source"
    },
    {
      "parameters": {
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.embeddingsOpenAi",
      "typeVersion": 1.2,
      "position": [
        1984,
        3536
      ],
      "id": "2df07d68-902e-4592-a203-edcdb16ea7e1",
      "name": "Embeddings OpenAI5"
    },
    {
      "parameters": {
        "mode": "retrieve-as-tool",
        "toolDescription": "get client info",
        "tableName": {
          "__rl": true,
          "value": "rpc/hybrid_search",
          "mode": "list",
          "cachedResultName": "rpc/hybrid_search"
        },
        "topK": 50,
        "options": {
          "metadata": {
            "metadataValues": [
              {
                "name": "={{\n  JSON.parse($json.query).metadata_name1\n}}",
                "value": "={{\n  JSON.parse($json.query).value1\n}}"
              }
            ]
          }
        }
      },
      "type": "@n8n/n8n-nodes-langchain.vectorStoreSupabase",
      "typeVersion": 1.3,
      "position": [
        1888,
        3392
      ],
      "id": "8dc59387-8dda-4af0-924e-9e9e82565fb5",
      "name": "1 filter",
      "notesInFlow": false
    },
    {
      "parameters": {
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.embeddingsOpenAi",
      "typeVersion": 1.2,
      "position": [
        1728,
        3536
      ],
      "id": "263c9639-6535-4278-b864-51dfccbf8bf1",
      "name": "Embeddings OpenAI"
    },
    {
      "parameters": {
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.embeddingsOpenAi",
      "typeVersion": 1.2,
      "position": [
        1472,
        3536
      ],
      "id": "c1421554-c4ad-4ef1-92dc-f93059f9139d",
      "name": "Embeddings OpenAI6"
    },
    {
      "parameters": {
        "mode": "retrieve-as-tool",
        "toolDescription": "get client info",
        "tableName": {
          "__rl": true,
          "value": "rpc/hybrid_search",
          "mode": "list",
          "cachedResultName": "rpc/hybrid_search"
        },
        "topK": 50,
        "options": {
          "metadata": {
            "metadataValues": [
              {
                "name": "={{\n  JSON.parse($json.query).metadata_name1\n}}",
                "value": "={{\n  JSON.parse($json.query).value1\n}}"
              },
              {
                "name": "={{   JSON.parse($json.query).metadata_name2 }}",
                "value": "={{   JSON.parse($json.query).value2 }}"
              }
            ]
          }
        }
      },
      "type": "@n8n/n8n-nodes-langchain.vectorStoreSupabase",
      "typeVersion": 1.3,
      "position": [
        1376,
        3392
      ],
      "id": "d5d7924c-d2d4-4c0a-b96d-07c78a7b677b",
      "name": "3 filters",
      "notesInFlow": false
    },
    {
      "parameters": {
        "mode": "retrieve-as-tool",
        "toolDescription": "get client info",
        "tableName": {
          "__rl": true,
          "value": "rpc/hybrid_search",
          "mode": "list",
          "cachedResultName": "rpc/hybrid_search"
        },
        "topK": 50,
        "options": {
          "metadata": {
            "metadataValues": [
              {
                "name": "={{\n  JSON.parse($json.query).metadata_name1\n}}\n",
                "value": "={{\n  JSON.parse($json.query).value1\n}}"
              },
              {
                "name": "={{   JSON.parse($json.query).metadata_name2 }}",
                "value": "={{   JSON.parse($json.query).value2 }}"
              }
            ]
          }
        }
      },
      "type": "@n8n/n8n-nodes-langchain.vectorStoreSupabase",
      "typeVersion": 1.3,
      "position": [
        1632,
        3392
      ],
      "id": "c5abeb02-5b66-4308-8cbe-cb79ba1530f5",
      "name": "2 filters",
      "notesInFlow": false
    },
    {
      "parameters": {
        "model": {
          "__rl": true,
          "mode": "list",
          "value": "gpt-4.1-mini"
        },
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.lmChatOpenAi",
      "typeVersion": 1.2,
      "position": [
        992,
        3392
      ],
      "id": "10dd79f3-3a88-44a8-9978-7a038cc7e6e9",
      "name": "OpenAI Chat Model9"
    }
  ],
  "connections": {
    "Gmail Trigger": {
      "main": [
        [
          {
            "node": "Is not fyxer",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Edit Fields": {
      "main": [
        [
          {
            "node": "AI Agent",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "OpenAI Chat Model": {
      "ai_languageModel": [
        [
          {
            "node": "AI Agent",
            "type": "ai_languageModel",
            "index": 0
          }
        ]
      ]
    },
    "Date & Time": {
      "ai_tool": [
        [
          {
            "node": "AI Agent",
            "type": "ai_tool",
            "index": 0
          }
        ]
      ]
    },
    "Structured Output Parser": {
      "ai_outputParser": [
        [
          {
            "node": "AI Agent",
            "type": "ai_outputParser",
            "index": 0
          }
        ]
      ]
    },
    "AI Agent": {
      "main": [
        [
          {
            "node": "Edit Fields1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "When chat message received": {
      "main": [
        [
          {
            "node": "AI Agent1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "OpenAI Chat Model1": {
      "ai_languageModel": [
        [
          {
            "node": "AI Agent1",
            "type": "ai_languageModel",
            "index": 0
          }
        ]
      ]
    },
    "Date & Time1": {
      "ai_tool": [
        [
          {
            "node": "AI Agent1",
            "type": "ai_tool",
            "index": 0
          }
        ]
      ]
    },
    "Supabase Vector Store2": {
      "ai_tool": [
        [
          {
            "node": "AI Agent1",
            "type": "ai_tool",
            "index": 0
          }
        ]
      ]
    },
    "Embeddings OpenAI2": {
      "ai_embedding": [
        [
          {
            "node": "Supabase Vector Store2",
            "type": "ai_embedding",
            "index": 0
          }
        ]
      ]
    },
    "AI Agent1": {
      "main": [
        []
      ]
    },
    "Webhook": {
      "main": [
        [
          {
            "node": "AI Agent2",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Structured Output Parser1": {
      "ai_outputParser": [
        [
          {
            "node": "AI Agent2",
            "type": "ai_outputParser",
            "index": 0
          }
        ]
      ]
    },
    "OpenAI Chat Model2": {
      "ai_languageModel": [
        [
          {
            "node": "AI Agent2",
            "type": "ai_languageModel",
            "index": 0
          }
        ]
      ]
    },
    "Supabase Vector Store1": {
      "ai_tool": [
        [
          {
            "node": "AI Agent2",
            "type": "ai_tool",
            "index": 0
          }
        ]
      ]
    },
    "Embeddings OpenAI1": {
      "ai_embedding": [
        [
          {
            "node": "Supabase Vector Store1",
            "type": "ai_embedding",
            "index": 0
          }
        ]
      ]
    },
    "Simple Memory": {
      "ai_memory": [
        [
          {
            "node": "AI Agent1",
            "type": "ai_memory",
            "index": 0
          }
        ]
      ]
    },
    "separate name and email": {
      "main": [
        [
          {
            "node": "Check from",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "If": {
      "main": [
        [
          {
            "node": "Edit Fields",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Check to",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Check from": {
      "main": [
        [
          {
            "node": "If",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Check to": {
      "main": [
        [
          {
            "node": "If1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "If1": {
      "main": [
        [
          {
            "node": "Edit Fields",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Edit Fields1": {
      "main": [
        [
          {
            "node": "Call 'rag'",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Loop Over Items": {
      "main": [
        [],
        [
          {
            "node": "separate name and email",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Call 'rag'": {
      "main": [
        [
          {
            "node": "Loop Over Items",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "separate name and email1": {
      "main": [
        [
          {
            "node": "Check from1",
            "type": "main",
            "index": 0
          },
          {
            "node": "Merge",
            "type": "main",
            "index": 1
          }
        ]
      ]
    },
    "OpenAI Chat Model3": {
      "ai_languageModel": [
        [
          {
            "node": "AI Agent3",
            "type": "ai_languageModel",
            "index": 0
          }
        ]
      ]
    },
    "Date & Time2": {
      "ai_tool": [
        [
          {
            "node": "AI Agent3",
            "type": "ai_tool",
            "index": 0
          }
        ]
      ]
    },
    "Structured Output Parser2": {
      "ai_outputParser": [
        [
          {
            "node": "AI Agent3",
            "type": "ai_outputParser",
            "index": 0
          }
        ]
      ]
    },
    "AI Agent3": {
      "main": [
        [
          {
            "node": "Merge",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "If3": {
      "main": [
        [
          {
            "node": "AI Agent3",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Check to1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Check from1": {
      "main": [
        [
          {
            "node": "If3",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Check to1": {
      "main": [
        [
          {
            "node": "If4",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Edit Fields2": {
      "main": [
        [
          {
            "node": "Call 'rag'1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "If4": {
      "main": [
        [
          {
            "node": "AI Agent3",
            "type": "main",
            "index": 0
          }
        ],
        []
      ]
    },
    "If5": {
      "main": [
        [
          {
            "node": "Edit Fields2",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Merge": {
      "main": [
        [
          {
            "node": "If5",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "contains file?": {
      "main": [
        [
          {
            "node": "separate name and email1",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Loop Over Items",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "validity check": {
      "main": [
        [
          {
            "node": "Check client",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Format metadata": {
      "main": [
        [
          {
            "node": "Call 'rag'1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Check client": {
      "main": [
        [
          {
            "node": "If2",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Edit Fields3": {
      "main": [
        [
          {
            "node": "AI Agent4",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "AI Agent4": {
      "main": [
        [
          {
            "node": "validity check",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "OpenAI Chat Model4": {
      "ai_languageModel": [
        [
          {
            "node": "AI Agent4",
            "type": "ai_languageModel",
            "index": 0
          }
        ]
      ]
    },
    "Structured Output Parser3": {
      "ai_outputParser": [
        [
          {
            "node": "AI Agent4",
            "type": "ai_outputParser",
            "index": 0
          }
        ]
      ]
    },
    "If2": {
      "main": [
        [
          {
            "node": "Format metadata",
            "type": "main",
            "index": 0
          }
        ],
        []
      ]
    },
    "Get fyxer notes": {
      "main": [
        []
      ]
    },
    "Is not fyxer": {
      "main": [
        [
          {
            "node": "contains file?",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Edit Fields3",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "separate name and email2": {
      "main": [
        [
          {
            "node": "AI Agent5",
            "type": "main",
            "index": 0
          },
          {
            "node": "Merge2",
            "type": "main",
            "index": 1
          }
        ]
      ]
    },
    "Loop Over Items1": {
      "main": [
        [],
        [
          {
            "node": "separate name and email2",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "AI Agent5": {
      "main": [
        [
          {
            "node": "client checker output",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "OpenAI Chat Model5": {
      "ai_languageModel": [
        [
          {
            "node": "AI Agent5",
            "type": "ai_languageModel",
            "index": 0
          }
        ]
      ]
    },
    "database_schema_query2": {
      "ai_tool": [
        []
      ]
    },
    "client_search_query2": {
      "ai_tool": [
        []
      ]
    },
    "Simple Memory2": {
      "ai_memory": [
        [
          {
            "node": "AI Agent5",
            "type": "ai_memory",
            "index": 0
          }
        ]
      ]
    },
    "Client Found?": {
      "main": [
        [
          {
            "node": "Merge2",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Reply to a message",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Edit Fields4": {
      "main": [
        [
          {
            "node": "AI Agent6",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Structured Output Parser4": {
      "ai_outputParser": [
        [
          {
            "node": "AI Agent6",
            "type": "ai_outputParser",
            "index": 0
          }
        ]
      ]
    },
    "Edit Fields5": {
      "main": [
        [
          {
            "node": "Call 'rag'2",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Call 'rag'2": {
      "main": [
        [
          {
            "node": "Loop Over Items1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "separate name and send file": {
      "main": [
        [
          {
            "node": "AI Agent5",
            "type": "main",
            "index": 0
          },
          {
            "node": "Merge2",
            "type": "main",
            "index": 1
          }
        ]
      ]
    },
    "Edit Fields6": {
      "main": [
        [
          {
            "node": "Call 'rag'3",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "contains file?1": {
      "main": [
        [
          {
            "node": "separate name and send file",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Loop Over Items1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "has file?": {
      "main": [
        [
          {
            "node": "Edit Fields6",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Edit Fields4",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Merge2": {
      "main": [
        [
          {
            "node": "has file?",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "client checker output": {
      "main": [
        [
          {
            "node": "Client Found?",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Gmail Trigger2": {
      "main": [
        [
          {
            "node": "contains file?1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "AI Agent6": {
      "main": [
        [
          {
            "node": "Edit Fields5",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "OpenAI Chat Model6": {
      "ai_languageModel": [
        [
          {
            "node": "AI Agent6",
            "type": "ai_languageModel",
            "index": 0
          }
        ]
      ]
    },
    "database_schema_query4": {
      "ai_tool": [
        [
          {
            "node": "AI Agent8",
            "type": "ai_tool",
            "index": 0
          }
        ]
      ]
    },
    "client_search_query4": {
      "ai_tool": [
        [
          {
            "node": "AI Agent8",
            "type": "ai_tool",
            "index": 0
          }
        ]
      ]
    },
    "Set metadata": {
      "main": [
        [
          {
            "node": "Call 'rag'4",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "is client and meeting note?": {
      "main": [
        [
          {
            "node": "Set metadata",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Get Full Meeting Data": {
      "main": [
        [
          {
            "node": "AI Agent8",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Get Latest Transcript": {
      "main": [
        [
          {
            "node": "Get Full Meeting Data",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Webhook2": {
      "main": [
        [
          {
            "node": "Get Latest Transcript",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "AI Agent8": {
      "main": [
        [
          {
            "node": "is client and meeting note?",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "OpenAI Chat Model8": {
      "ai_languageModel": [
        [
          {
            "node": "AI Agent8",
            "type": "ai_languageModel",
            "index": 0
          }
        ]
      ]
    },
    "Structured Output Parser6": {
      "ai_outputParser": [
        [
          {
            "node": "AI Agent8",
            "type": "ai_outputParser",
            "index": 0
          }
        ]
      ]
    },
    "Date & Time Tool": {
      "ai_tool": [
        [
          {
            "node": "Client Intelligence Agent",
            "type": "ai_tool",
            "index": 0
          }
        ]
      ]
    },
    "Supabase Search": {
      "ai_tool": [
        [
          {
            "node": "Client Intelligence Agent",
            "type": "ai_tool",
            "index": 0
          }
        ]
      ]
    },
    "Client data": {
      "ai_tool": [
        [
          {
            "node": "Client Intelligence Agent",
            "type": "ai_tool",
            "index": 0
          }
        ]
      ]
    },
    "Edit Fields7": {
      "main": [
        [
          {
            "node": "Client Intelligence Agent",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Webhook1": {
      "main": [
        [
          {
            "node": "Edit Fields7",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "OpenAI Chat Model7": {
      "ai_languageModel": [
        [
          {
            "node": "Client Intelligence Agent",
            "type": "ai_languageModel",
            "index": 0
          }
        ]
      ]
    },
    "client_search_query": {
      "ai_tool": [
        [
          {
            "node": "Client Intelligence Agent",
            "type": "ai_tool",
            "index": 0
          }
        ]
      ]
    },
    "When Executed by Another Workflow": {
      "main": [
        [
          {
            "node": "Get client info by name and source",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Embeddings OpenAI5": {
      "ai_embedding": [
        [
          {
            "node": "1 filter",
            "type": "ai_embedding",
            "index": 0
          }
        ]
      ]
    },
    "1 filter": {
      "ai_tool": [
        [
          {
            "node": "Get client info by name and source",
            "type": "ai_tool",
            "index": 0
          }
        ]
      ]
    },
    "Embeddings OpenAI": {
      "ai_embedding": [
        [
          {
            "node": "2 filters",
            "type": "ai_embedding",
            "index": 0
          }
        ]
      ]
    },
    "Embeddings OpenAI6": {
      "ai_embedding": [
        [
          {
            "node": "3 filters",
            "type": "ai_embedding",
            "index": 0
          }
        ]
      ]
    },
    "3 filters": {
      "ai_tool": [
        [
          {
            "node": "Get client info by name and source",
            "type": "ai_tool",
            "index": 0
          }
        ]
      ]
    },
    "2 filters": {
      "ai_tool": [
        [
          {
            "node": "Get client info by name and source",
            "type": "ai_tool",
            "index": 0
          }
        ]
      ]
    },
    "OpenAI Chat Model9": {
      "ai_languageModel": [
        [
          {
            "node": "Get client info by name and source",
            "type": "ai_languageModel",
            "index": 0
          }
        ]
      ]
    }
  },
  "settings": {
    "executionOrder": "v1"
  },
  "staticData": {
    "node:Gmail Trigger": {
      "Gmail Trigger": {
        "lastTimeChecked": 1758627013,
        "possibleDuplicates": [
          "1997656a38473902"
        ]
      }
    },
    "node:Gmail Trigger1": {
      "Gmail Trigger1": {
        "lastTimeChecked": 1758622807,
        "possibleDuplicates": [
          "19976167a4d32907"
        ]
      }
    },
    "node:Get fyxer notes": {
      "Get fyxer notes": {
        "lastTimeChecked": 1758627656
      }
    },
    "node:Gmail Trigger2": {
      "Gmail Trigger2": {
        "lastTimeChecked": 1758627656
      }
    }
  },
  "meta": {
    "templateCredsSetupCompleted": true
  },
  "pinData": {
    "Webhook1": [
      {
        "json": {
          "headers": {
            "host": "mark-young.app.n8n.cloud",
            "user-agent": "Python/3.11 aiohttp/3.12.15",
            "content-length": "296",
            "accept": "*/*",
            "accept-encoding": "gzip, br",
            "authorization": "Bearer ajflq328973426548273shjkvhsofiyusjkdfvs",
            "cdn-loop": "cloudflare; loops=1; subreqs=1",
            "cf-access-client-id": "",
            "cf-access-client-secret": "",
            "cf-connecting-ip": "152.53.150.73",
            "cf-ew-via": "15",
            "cf-ipcountry": "DE",
            "cf-ray": "98006d1e57a3697f-FRA",
            "cf-visitor": "{\"scheme\":\"https\"}",
            "cf-worker": "n8n.cloud",
            "content-type": "application/json",
            "x-forwarded-for": "152.53.150.73, 162.158.87.78",
            "x-forwarded-host": "mark-young.app.n8n.cloud",
            "x-forwarded-port": "443",
            "x-forwarded-proto": "https",
            "x-forwarded-server": "traefik-prod-users-gwc-3-6db8488cf7-vdndp",
            "x-is-trusted": "yes",
            "x-real-ip": "152.53.150.73"
          },
          "params": {},
          "query": {},
          "body": {
            "systemPrompt": "hey",
            "user_id": "b7561c6e-1808-4d50-82a6-35fb78e2a0ff",
            "user_email": "yonatantesfaye30@gmail.com",
            "user_name": "Yonatan Tesfaye",
            "user_role": "admin",
            "chat_id": "9945b87b-48d7-4224-9033-c0da1293c134",
            "message_id": "ad2f98fd-8b05-4c87-a448-97b638eb7eae",
            "chatInput": "hi"
          },
          "webhookUrl": "https://mark-young.app.n8n.cloud/webhook/5d3d89f9-c8b4-4b13-8a69-54ee3f6332a2",
          "executionMode": "production"
        }
      }
    ],
    "When Executed by Another Workflow": [
      {
        "json": {
          "query": "{\"metadata_name1\": \"source_type\", \"value1\": \"slack\", \"metadata_name2\": \"client_name\", \"value2\": \"pawlos feleke\", \"metadata_name3\": \"date\", \"value3\": \"2025-10-06\"}"
        }
      }
    ]
  },
  "versionId": "9961933e-8d81-4442-ad91-dba2e8afcc21",
  "triggerCount": 6,
  "tags": [],
  "shared": [
    {
      "createdAt": "2025-09-08T10:44:13.512Z",
      "updatedAt": "2025-09-08T10:44:13.512Z",
      "role": "workflow:owner",
      "workflowId": "c7UcEhP80Dc5jzk3",
      "projectId": "IQ4w3zW02fJzIdTt",
      "project": {
        "createdAt": "2025-01-25T02:11:56.995Z",
        "updatedAt": "2025-01-25T21:11:21.957Z",
        "id": "IQ4w3zW02fJzIdTt",
        "name": "Yonatan Tesfaye <yonatantesfaye30@gmail.com>",
        "type": "personal",
        "icon": null,
        "description": null
      }
    }
  ]
}