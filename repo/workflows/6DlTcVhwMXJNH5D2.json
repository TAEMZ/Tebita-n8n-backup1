{
  "createdAt": "2025-04-29T21:03:29.152Z",
  "updatedAt": "2025-05-01T10:09:32.128Z",
  "id": "6DlTcVhwMXJNH5D2",
  "name": "Book Rag",
  "active": false,
  "isArchived": false,
  "nodes": [
    {
      "parameters": {
        "options": {}
      },
      "id": "9ce51b2b-ba93-4b4a-96ff-5aad55472b17",
      "name": "OpenAI Chat Model",
      "type": "@n8n/n8n-nodes-langchain.lmChatOpenAi",
      "typeVersion": 1,
      "position": [
        -760,
        280
      ],
      "credentials": {
        "openAiApi": {
          "id": "TUNbbZhFy4QjUJm0",
          "name": "New Open ai "
        }
      }
    },
    {
      "parameters": {
        "jsonMode": "expressionData",
        "jsonData": "={{ $json.data || $json.text || $json.concatenated_data }}",
        "options": {
          "metadata": {
            "metadataValues": [
              {
                "name": "=file_id",
                "value": "={{ $('Set File ID').first().json.file_id }}"
              },
              {
                "name": "file_title",
                "value": "={{ $('Set File ID').first().json.file_title }}"
              }
            ]
          }
        }
      },
      "id": "cc87d031-e2ce-4e52-b23e-e591d8d62481",
      "name": "Default Data Loader",
      "type": "@n8n/n8n-nodes-langchain.documentDefaultDataLoader",
      "typeVersion": 1,
      "position": [
        980,
        1060
      ]
    },
    {
      "parameters": {
        "model": "text-embedding-3-small",
        "options": {}
      },
      "id": "1fae86c4-9222-4920-8c82-a22857f8e235",
      "name": "Embeddings OpenAI1",
      "type": "@n8n/n8n-nodes-langchain.embeddingsOpenAi",
      "typeVersion": 1,
      "position": [
        740,
        1060
      ],
      "credentials": {
        "openAiApi": {
          "id": "TUNbbZhFy4QjUJm0",
          "name": "New Open ai "
        }
      }
    },
    {
      "parameters": {
        "content": "## Agent Tools for RAG",
        "height": 528.85546469693,
        "width": 583.4552380860637,
        "color": 4
      },
      "id": "3746ad11-3cee-4f78-a13d-20c32a8fb8fc",
      "name": "Sticky Note",
      "type": "n8n-nodes-base.stickyNote",
      "typeVersion": 1,
      "position": [
        -20,
        -80
      ]
    },
    {
      "parameters": {
        "content": "## Tool to Add a Google Drive File to Vector DB",
        "height": 1067,
        "width": 3073,
        "color": 5
      },
      "id": "a6ef6bea-7974-4394-a188-a5d05647d24a",
      "name": "Sticky Note1",
      "type": "n8n-nodes-base.stickyNote",
      "typeVersion": 1,
      "position": [
        -1700,
        480
      ]
    },
    {
      "parameters": {
        "operation": "text",
        "options": {}
      },
      "id": "de3f2bf3-14c3-4c74-995d-7e674654aa1e",
      "name": "Extract Document Text",
      "type": "n8n-nodes-base.extractFromFile",
      "typeVersion": 1,
      "position": [
        180,
        1060
      ],
      "alwaysOutputData": true
    },
    {
      "parameters": {},
      "id": "3cd5c5cf-5285-4df2-b5da-cab5c437c503",
      "name": "Postgres Chat Memory",
      "type": "@n8n/n8n-nodes-langchain.memoryPostgresChat",
      "typeVersion": 1,
      "position": [
        -620,
        280
      ],
      "notesInFlow": false,
      "credentials": {
        "postgres": {
          "id": "fVjbfOzLkxC2OvEn",
          "name": "BOX"
        }
      }
    },
    {
      "parameters": {
        "operation": "delete",
        "tableId": "documents",
        "filterType": "string",
        "filterString": "=metadata->>file_id=like.*{{ $json.file_id }}*"
      },
      "id": "a4423227-80a4-4fb5-ab90-dffa93271324",
      "name": "Delete Old Doc Rows",
      "type": "n8n-nodes-base.supabase",
      "typeVersion": 1,
      "position": [
        -1160,
        580
      ],
      "alwaysOutputData": true,
      "credentials": {
        "supabaseApi": {
          "id": "A7mzjq3DccqVxRhE",
          "name": "Supabase account 3"
        }
      }
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "10646eae-ae46-4327-a4dc-9987c2d76173",
              "name": "file_id",
              "value": "={{ $('Check the Trigger').item.json.body.source.id }}",
              "type": "string"
            },
            {
              "id": "f4536df5-d0b1-4392-bf17-b8137fb31a44",
              "name": "file_type",
              "value": "={{ $json.extension }}",
              "type": "string"
            },
            {
              "id": "77d782de-169d-4a46-8a8e-a3831c04d90f",
              "name": "file_title",
              "value": "={{ $('Check the Trigger').item.json.body.source.name }}",
              "type": "string"
            }
          ]
        },
        "options": {}
      },
      "id": "719fafe0-99bc-489a-bc80-109ee97ef9af",
      "name": "Set File ID",
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        -1320,
        740
      ]
    },
    {
      "parameters": {
        "content": "## RAG AI Agent with Chat Interface",
        "height": 464.8027193303974,
        "width": 1035.6381264595484
      },
      "id": "ce8e0515-ee41-4884-8fef-bd474ccf0927",
      "name": "Sticky Note2",
      "type": "n8n-nodes-base.stickyNote",
      "typeVersion": 1,
      "position": [
        -1060,
        -20
      ]
    },
    {
      "parameters": {
        "options": {}
      },
      "id": "fb61f10f-e8c6-4409-8919-7b73a36f99af",
      "name": "Respond to Webhook",
      "type": "n8n-nodes-base.respondToWebhook",
      "typeVersion": 1.1,
      "position": [
        -200,
        60
      ]
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "9a9a245e-f1a1-4282-bb02-a81ffe629f0f",
              "name": "chatInput",
              "value": "={{ $json?.chatInput || $json.body.chatInput }}",
              "type": "string"
            },
            {
              "id": "b80831d8-c653-4203-8706-adedfdb98f77",
              "name": "sessionId",
              "value": "={{ $json?.sessionId || $json.body.sessionId}}",
              "type": "string"
            }
          ]
        },
        "options": {}
      },
      "id": "c58db8d5-6dd9-4a8d-91ea-17651071be2c",
      "name": "Edit Fields",
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        -760,
        60
      ]
    },
    {
      "parameters": {
        "public": true,
        "options": {}
      },
      "id": "586b7002-0607-4cf8-a7fb-86992ae83a3f",
      "name": "When chat message received",
      "type": "@n8n/n8n-nodes-langchain.chatTrigger",
      "typeVersion": 1.1,
      "position": [
        -1020,
        60
      ],
      "webhookId": "e104e40e-6134-4825-a6f0-8a646d882662"
    },
    {
      "parameters": {
        "httpMethod": "POST",
        "path": "bf4dd093-bb02-472c-9454-7ab9af97bd1d",
        "authentication": "headerAuth",
        "responseMode": "responseNode",
        "options": {}
      },
      "id": "7b7de0b1-b85d-40aa-bdeb-dd633b36daa7",
      "name": "Webhook",
      "type": "n8n-nodes-base.webhook",
      "typeVersion": 2,
      "position": [
        -1020,
        260
      ],
      "webhookId": "bf4dd093-bb02-472c-9454-7ab9af97bd1d",
      "credentials": {
        "httpHeaderAuth": {
          "id": "MoOzBggpmmvQVB88",
          "name": "Open Router Auth"
        }
      },
      "disabled": true
    },
    {
      "parameters": {
        "operation": "pdf",
        "options": {}
      },
      "id": "77c24eb0-ba2e-40ac-9dc2-321003e7624c",
      "name": "Extract PDF Text",
      "type": "n8n-nodes-base.extractFromFile",
      "typeVersion": 1,
      "position": [
        180,
        500
      ],
      "alwaysOutputData": true
    },
    {
      "parameters": {
        "aggregate": "aggregateAllItemData",
        "options": {}
      },
      "id": "f94cddad-9478-410f-a75f-46c982d83213",
      "name": "Aggregate",
      "type": "n8n-nodes-base.aggregate",
      "typeVersion": 1,
      "position": [
        220,
        680
      ]
    },
    {
      "parameters": {},
      "id": "efa146ac-8801-4901-8ea8-3187b295aedf",
      "name": "Character Text Splitter",
      "type": "@n8n/n8n-nodes-langchain.textSplitterCharacterTextSplitter",
      "typeVersion": 1,
      "position": [
        880,
        1180
      ]
    },
    {
      "parameters": {
        "fieldsToSummarize": {
          "values": [
            {
              "aggregation": "concatenate",
              "field": "data"
            }
          ]
        },
        "options": {}
      },
      "id": "b7258d1a-ca0e-40d2-b242-76079de03b51",
      "name": "Summarize",
      "type": "n8n-nodes-base.summarize",
      "typeVersion": 1,
      "position": [
        420,
        760
      ]
    },
    {
      "parameters": {
        "promptType": "define",
        "text": "={{ $json.chatInput }}",
        "options": {
          "systemMessage": "You are a personal assistant who helps answer questions from a corpus of documents. The documents are either text based (Txt, docs, extracted PDFs, etc.) or tabular data (CSVs or Excel documents).\n\nYou are given tools to perform RAG in the 'documents' table, look up the documents available in your knowledge base in the 'document_metadata' table, extract all the text from a given document, and query the tabular files with SQL in the 'document_rows' table.\n\nAlways start by performing RAG unless the question requires a SQL query for tabular data (fetching a sum, finding a max, something a RAG lookup would be unreliable for). If RAG doesn't help, then look at the documents that are available to you, find a few that you think would contain the answer, and then analyze those.\n\nAlways tell the user if you didn't find the answer. Don't make something up just to please them."
        }
      },
      "id": "cf7a1428-17d8-4495-bd88-cc0f67bb83cf",
      "name": "RAG AI Agent",
      "type": "@n8n/n8n-nodes-langchain.agent",
      "typeVersion": 1.6,
      "position": [
        -540,
        60
      ]
    },
    {
      "parameters": {
        "rules": {
          "values": [
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 1
                },
                "conditions": [
                  {
                    "leftValue": "={{ $('Set File ID').item.json.file_type }}",
                    "rightValue": "pdf",
                    "operator": {
                      "type": "string",
                      "operation": "equals"
                    },
                    "id": "4eb774be-f681-404f-93f6-92849d9cca23"
                  }
                ],
                "combinator": "and"
              }
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 1
                },
                "conditions": [
                  {
                    "id": "2ae7faa7-a936-4621-a680-60c512163034",
                    "leftValue": "={{ $('Set File ID').item.json.file_type }}",
                    "rightValue": "application/vnd.openxmlformats-officedocument.spreadsheetml.sheet",
                    "operator": {
                      "type": "string",
                      "operation": "equals",
                      "name": "filter.operator.equals"
                    }
                  }
                ],
                "combinator": "and"
              }
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 1
                },
                "conditions": [
                  {
                    "id": "fc193b06-363b-4699-a97d-e5a850138b0e",
                    "leftValue": "={{ $('Set File ID').item.json.file_type }}",
                    "rightValue": "=csv",
                    "operator": {
                      "type": "string",
                      "operation": "equals",
                      "name": "filter.operator.equals"
                    }
                  }
                ],
                "combinator": "and"
              }
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 1
                },
                "conditions": [
                  {
                    "id": "b69f5605-0179-4b02-9a32-e34bb085f82d",
                    "leftValue": "={{ $('Set File ID').item.json.file_type }}",
                    "rightValue": "pdf",
                    "operator": {
                      "type": "string",
                      "operation": "equals",
                      "name": "filter.operator.equals"
                    }
                  }
                ],
                "combinator": "and"
              }
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 1
                },
                "conditions": [
                  {
                    "id": "507d177d-49c2-4d86-b1b3-38a3ff6a14f1",
                    "leftValue": "={{ $('Set File ID').item.json.file_type }}",
                    "rightValue": "m4a",
                    "operator": {
                      "type": "string",
                      "operation": "equals",
                      "name": "filter.operator.equals"
                    }
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "audio"
            }
          ]
        },
        "options": {
          "fallbackOutput": 3
        }
      },
      "id": "2c269ef3-93ff-4665-9477-05fc40c37719",
      "name": "Switch",
      "type": "n8n-nodes-base.switch",
      "typeVersion": 3,
      "position": [
        -480,
        720
      ]
    },
    {
      "parameters": {
        "mode": "insert",
        "tableName": {
          "__rl": true,
          "value": "documents",
          "mode": "list",
          "cachedResultName": "documents"
        },
        "options": {
          "queryName": "match_documents"
        }
      },
      "id": "794873dc-4426-474e-b02f-e26bb341291d",
      "name": "Insert into Supabase Vectorstore",
      "type": "@n8n/n8n-nodes-langchain.vectorStoreSupabase",
      "typeVersion": 1,
      "position": [
        900,
        840
      ],
      "credentials": {
        "supabaseApi": {
          "id": "A7mzjq3DccqVxRhE",
          "name": "Supabase account 3"
        }
      }
    },
    {
      "parameters": {
        "operation": "xlsx",
        "options": {}
      },
      "id": "502205a0-866b-43f6-83b6-74764a8f5b43",
      "name": "Extract from Excel",
      "type": "n8n-nodes-base.extractFromFile",
      "typeVersion": 1,
      "position": [
        0,
        680
      ],
      "alwaysOutputData": true
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "f422e2e0-381c-46ea-8f38-3f58c501d8b9",
              "name": "schema",
              "value": "={{ $('Extract from Excel').isExecuted ? $('Extract from Excel').first().json.keys().toJsonString() : $('Extract from CSV').first().json.keys().toJsonString() }}",
              "type": "string"
            },
            {
              "id": "bb07c71e-5b60-4795-864c-cc3845b6bc46",
              "name": "data",
              "value": "={{ $json.concatenated_data }}",
              "type": "string"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        860,
        620
      ],
      "id": "f8b23beb-381f-47cf-bc34-e467ca95e358",
      "name": "Set Schema"
    },
    {
      "parameters": {
        "options": {}
      },
      "type": "n8n-nodes-base.extractFromFile",
      "typeVersion": 1,
      "position": [
        0,
        860
      ],
      "id": "187eb4d3-5e2c-4fee-91d2-bfead6048335",
      "name": "Extract from CSV",
      "executeOnce": false,
      "alwaysOutputData": true
    },
    {
      "parameters": {
        "content": "## Run Each Node Once to Set Up Database Tables",
        "height": 300,
        "width": 680,
        "color": 3
      },
      "type": "n8n-nodes-base.stickyNote",
      "position": [
        -1760,
        140
      ],
      "typeVersion": 1,
      "id": "692b2d81-6f87-4723-bc78-30009791e4b5",
      "name": "Sticky Note3"
    },
    {
      "parameters": {
        "operation": "executeQuery",
        "query": "CREATE TABLE document_metadata (\n    id TEXT PRIMARY KEY,\n    title TEXT,\n    url TEXT,\n    created_at TIMESTAMP DEFAULT NOW(),\n    schema TEXT\n);",
        "options": {}
      },
      "type": "n8n-nodes-base.postgres",
      "typeVersion": 2.5,
      "position": [
        -1500,
        240
      ],
      "id": "41c68551-e523-40c8-9caa-0721e03aa6c2",
      "name": "Create Document Metadata Table",
      "credentials": {
        "postgres": {
          "id": "fVjbfOzLkxC2OvEn",
          "name": "BOX"
        }
      }
    },
    {
      "parameters": {
        "operation": "executeQuery",
        "query": "CREATE TABLE document_rows (\n    id SERIAL PRIMARY KEY,\n    dataset_id TEXT REFERENCES document_metadata(id),\n    row_data JSONB  -- Store the actual row data\n);",
        "options": {}
      },
      "type": "n8n-nodes-base.postgres",
      "typeVersion": 2.5,
      "position": [
        -1280,
        240
      ],
      "id": "768b1be9-1bae-4827-a6dd-80152658d7d3",
      "name": "Create Document Rows Table (for Tabular Data)",
      "credentials": {
        "postgres": {
          "id": "fVjbfOzLkxC2OvEn",
          "name": "BOX"
        }
      }
    },
    {
      "parameters": {
        "descriptionType": "manual",
        "toolDescription": "Use this tool to fetch all available documents, including the table schema if the file is a CSV or Excel file.",
        "operation": "select",
        "schema": {
          "__rl": true,
          "mode": "list",
          "value": "public"
        },
        "table": {
          "__rl": true,
          "value": "document_metadata",
          "mode": "list",
          "cachedResultName": "document_metadata"
        },
        "returnAll": true,
        "options": {}
      },
      "type": "n8n-nodes-base.postgresTool",
      "typeVersion": 2.5,
      "position": [
        -480,
        280
      ],
      "id": "20be37e9-107f-4a3a-b65a-4e506847321a",
      "name": "List Documents",
      "credentials": {
        "postgres": {
          "id": "fVjbfOzLkxC2OvEn",
          "name": "BOX"
        }
      }
    },
    {
      "parameters": {
        "descriptionType": "manual",
        "toolDescription": "Given a file ID, fetches the text from the document.",
        "operation": "executeQuery",
        "query": "SELECT \n    string_agg(content, ' ') as document_text\nFROM documents\n  WHERE metadata->>'file_id' = $1\nGROUP BY metadata->>'file_id';",
        "options": {
          "queryReplacement": "={{ $fromAI('file_id') }}"
        }
      },
      "type": "n8n-nodes-base.postgresTool",
      "typeVersion": 2.5,
      "position": [
        -340,
        280
      ],
      "id": "93eeb0d8-5335-4c32-9789-d6de7012eb2f",
      "name": "Get File Contents",
      "credentials": {
        "postgres": {
          "id": "fVjbfOzLkxC2OvEn",
          "name": "BOX"
        }
      }
    },
    {
      "parameters": {
        "descriptionType": "manual",
        "toolDescription": "Run a SQL query - use this to query from the document_rows table once you know the file ID you are querying. dataset_id is the file_id and you are always using the row_data for filtering, which is a jsonb field that has all the keys from the file schema given in the document_metadata table.\n\nExample query:\n\nSELECT AVG((row_data->>'revenue')::numeric)\nFROM document_rows\nWHERE dataset_id = '123';\n\nExample query 2:\n\nSELECT \n    row_data->>'category' as category,\n    SUM((row_data->>'sales')::numeric) as total_sales\nFROM dataset_rows\nWHERE dataset_id = '123'\nGROUP BY row_data->>'category';",
        "operation": "executeQuery",
        "query": "{{ $fromAI('sql_query') }}",
        "options": {}
      },
      "type": "n8n-nodes-base.postgresTool",
      "typeVersion": 2.5,
      "position": [
        -180,
        280
      ],
      "id": "65065295-caed-4df4-9dde-4b24e4253d33",
      "name": "Query Document Rows",
      "credentials": {
        "postgres": {
          "id": "fVjbfOzLkxC2OvEn",
          "name": "BOX"
        }
      }
    },
    {
      "parameters": {
        "mode": "retrieve-as-tool",
        "toolName": "documents",
        "toolDescription": "Use RAG to look up information in the knowledgebase.",
        "tableName": {
          "__rl": true,
          "value": "documents",
          "mode": "list",
          "cachedResultName": "documents"
        },
        "options": {
          "queryName": "match_documents"
        }
      },
      "type": "@n8n/n8n-nodes-langchain.vectorStoreSupabase",
      "typeVersion": 1,
      "position": [
        140,
        60
      ],
      "id": "c330cc00-bf73-475c-9a4d-15bdd52915ec",
      "name": "Supabase Vector Store1",
      "credentials": {
        "supabaseApi": {
          "id": "A7mzjq3DccqVxRhE",
          "name": "Supabase account 3"
        }
      }
    },
    {
      "parameters": {
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.embeddingsOpenAi",
      "typeVersion": 1.2,
      "position": [
        240,
        240
      ],
      "id": "fdd8d6a6-a405-4651-83f5-309ca27ce3e3",
      "name": "Embeddings OpenAI2",
      "credentials": {
        "openAiApi": {
          "id": "TUNbbZhFy4QjUJm0",
          "name": "New Open ai "
        }
      }
    },
    {
      "parameters": {
        "operation": "executeQuery",
        "query": "-- Enable the pgvector extension to work with embedding vectors\ncreate extension vector;\n\n-- Create a table to store your documents\ncreate table documents (\n  id bigserial primary key,\n  content text, -- corresponds to Document.pageContent\n  metadata jsonb, -- corresponds to Document.metadata\n  embedding vector(1536) -- 1536 works for OpenAI embeddings, change if needed\n);\n\n-- Create a function to search for documents\ncreate function match_documents (\n  query_embedding vector(1536),\n  match_count int default null,\n  filter jsonb DEFAULT '{}'\n) returns table (\n  id bigint,\n  content text,\n  metadata jsonb,\n  similarity float\n)\nlanguage plpgsql\nas $$\n#variable_conflict use_column\nbegin\n  return query\n  select\n    id,\n    content,\n    metadata,\n    1 - (documents.embedding <=> query_embedding) as similarity\n  from documents\n  where metadata @> filter\n  order by documents.embedding <=> query_embedding\n  limit match_count;\nend;\n$$;",
        "options": {}
      },
      "type": "n8n-nodes-base.postgres",
      "typeVersion": 2.5,
      "position": [
        -1700,
        240
      ],
      "id": "0ff64dac-1a3c-46d5-8578-90ccabb44366",
      "name": "Create Documents Table and Match Function",
      "credentials": {
        "postgres": {
          "id": "fVjbfOzLkxC2OvEn",
          "name": "BOX"
        }
      }
    },
    {
      "parameters": {
        "operation": "delete",
        "tableId": "document_rows",
        "filters": {
          "conditions": [
            {
              "keyName": "dataset_id",
              "condition": "eq",
              "keyValue": "={{ $('Set File ID').item.json.file_id }}"
            }
          ]
        }
      },
      "type": "n8n-nodes-base.supabase",
      "typeVersion": 1,
      "position": [
        -1000,
        740
      ],
      "id": "fb3cc79e-4d11-4d04-9d6a-219635fe00cd",
      "name": "Delete Old Data Rows",
      "alwaysOutputData": true,
      "executeOnce": true,
      "credentials": {
        "supabaseApi": {
          "id": "A7mzjq3DccqVxRhE",
          "name": "Supabase account 3"
        }
      }
    },
    {
      "parameters": {
        "operation": "upsert",
        "schema": {
          "__rl": true,
          "mode": "list",
          "value": "public"
        },
        "table": {
          "__rl": true,
          "value": "document_metadata",
          "mode": "list",
          "cachedResultName": "document_metadata"
        },
        "columns": {
          "mappingMode": "defineBelow",
          "value": {
            "id": "={{ $('Set File ID').item.json.file_id }}",
            "title": "={{ $('Set File ID').item.json.file_title }}",
            "url": "={{ $('Set File ID').item.json.file_url }}"
          },
          "matchingColumns": [
            "id"
          ],
          "schema": [
            {
              "id": "id",
              "displayName": "id",
              "required": true,
              "defaultMatch": true,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "title",
              "displayName": "title",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": false
            },
            {
              "id": "url",
              "displayName": "url",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": false,
              "removed": false
            },
            {
              "id": "created_at",
              "displayName": "created_at",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "dateTime",
              "canBeUsedToMatch": false
            },
            {
              "id": "schema",
              "displayName": "schema",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": false,
              "removed": true
            }
          ],
          "attemptToConvertTypes": false,
          "convertFieldsToString": false
        },
        "options": {}
      },
      "type": "n8n-nodes-base.postgres",
      "typeVersion": 2.5,
      "position": [
        -840,
        600
      ],
      "id": "fd7e00aa-3aef-4efc-a5ac-2d2d5b545b62",
      "name": "Insert Document Metadata",
      "executeOnce": true,
      "credentials": {
        "postgres": {
          "id": "fVjbfOzLkxC2OvEn",
          "name": "BOX"
        }
      },
      "disabled": true
    },
    {
      "parameters": {
        "schema": {
          "__rl": true,
          "mode": "list",
          "value": "public"
        },
        "table": {
          "__rl": true,
          "value": "document_rows",
          "mode": "list",
          "cachedResultName": "document_rows"
        },
        "columns": {
          "mappingMode": "defineBelow",
          "value": {
            "dataset_id": "={{ $('Set File ID').item.json.file_id }}",
            "row_data": "={{ $json.toJsonString().replaceAll(/'/g, \"''\") }}"
          },
          "matchingColumns": [
            "id"
          ],
          "schema": [
            {
              "id": "id",
              "displayName": "id",
              "required": false,
              "defaultMatch": true,
              "display": true,
              "type": "number",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "dataset_id",
              "displayName": "dataset_id",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "row_data",
              "displayName": "row_data",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "object",
              "canBeUsedToMatch": true
            }
          ],
          "attemptToConvertTypes": false,
          "convertFieldsToString": false
        },
        "options": {}
      },
      "type": "n8n-nodes-base.postgres",
      "typeVersion": 2.5,
      "position": [
        220,
        860
      ],
      "id": "aebbed15-5f7c-4322-8a82-853cc24836f5",
      "name": "Insert Table Rows",
      "credentials": {
        "postgres": {
          "id": "fVjbfOzLkxC2OvEn",
          "name": "BOX"
        }
      }
    },
    {
      "parameters": {
        "operation": "upsert",
        "schema": {
          "__rl": true,
          "mode": "list",
          "value": "public"
        },
        "table": {
          "__rl": true,
          "value": "document_metadata",
          "mode": "list",
          "cachedResultName": "document_metadata"
        },
        "columns": {
          "mappingMode": "defineBelow",
          "value": {
            "id": "={{ $('Set File ID').item.json.file_id }}",
            "schema": "={{ $json.schema }}"
          },
          "matchingColumns": [
            "id"
          ],
          "schema": [
            {
              "id": "id",
              "displayName": "id",
              "required": true,
              "defaultMatch": true,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "title",
              "displayName": "title",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": false,
              "removed": true
            },
            {
              "id": "url",
              "displayName": "url",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": false,
              "removed": true
            },
            {
              "id": "created_at",
              "displayName": "created_at",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "dateTime",
              "canBeUsedToMatch": false
            },
            {
              "id": "schema",
              "displayName": "schema",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": false,
              "removed": false
            }
          ],
          "attemptToConvertTypes": false,
          "convertFieldsToString": false
        },
        "options": {}
      },
      "type": "n8n-nodes-base.postgres",
      "typeVersion": 2.5,
      "position": [
        1080,
        620
      ],
      "id": "315bb2fe-81df-4707-8e54-bd14fd2e39ac",
      "name": "Update Schema for Document Metadata",
      "credentials": {
        "postgres": {
          "id": "fVjbfOzLkxC2OvEn",
          "name": "BOX"
        }
      }
    },
    {
      "parameters": {
        "content": "## ðŸš€ Agentic RAG n8n Workflow Documentation\n\n## Overview\nThis workflow implements an **Agentic Retrieval-Augmented Generation (RAG)** system. It:\n\n- Listens for file events (uploads/deletions) via Box webhooks\n- Ingests documents (PDF, TXT, CSV, Excel) and tabular data\n- Extracts and aggregates content\n- Stores metadata and embeddings in Supabase and Postgres\n- Exposes a chat interface powered by an AI agent that dynamically selects RAG lookups or SQL queries\n- Responds in real time via webhook\n\n---\n\n## Workflow Steps\n\n### A. Database Initialization\n1. **Create Documents Table & Match Function**: Defines a `documents` table and RAG lookup function\n2. **Create Document Metadata Table**: Stores file metadata (id, title, URL, schema)\n3. **Create Document Rows Table**: Holds tabular rows in JSONB format for SQL queries\n\n> Run these nodes once at setup\n\n### B. File Ingestion & Routing\n1. **Box Webhook**: Listens for Box events (FILE.UPLOADED, FILE.DELETED, etc.)\n2. **Check the Trigger (Switch)**: Routes based on event type: created vs deleted\n3. **Set File ID**: Extracts file metadata from the payload\n\n### C. Content Extraction & Processing\n1. **Box Download**: Downloads the file binary\n2. **Switch on File Type**: Routes to the appropriate extract node\n3. **Aggregate**: Merges extracted chunks into a single field\n4. **Character Text Splitter**: Splits large text into chunks\n5. **Default Data Loader**: Prepares JSON documents for vector store insertion\n\n### D. Storage & Indexing\n1. **Embeddings OpenAI**: Generates vector embeddings for each text chunk\n2. **Insert into Supabase Vectorstore**: Inserts embeddings and metadata into Supabase\n3. **Delete Old Data Rows**: Cleans up existing entries for updated files\n4. **Insert Table Rows**: Stores each row of Excel/CSV as JSONB in Supabase\n5. **Insert Document Metadata**: Upserts file metadata in Postgres\n6. **Update Schema for Document Metadata**: Records the detected schema for tabular files\n\n### E. Chat Interface & RAG Agent\n1. **Chat Trigger**: Exposes a hosted chat webhook\n2. **Edit Fields**: Maps incoming payload (`chatInput`, `sessionId`)\n3. **RAG AI Agent**: Dynamically selects retrieval via vector store or SQL\n4. **Respond to Webhook**: Returns the AIâ€™s response to the chat client\n\n---\n\n## Customization & Extension\n- **Swap File Storage**: Replace Box nodes with Google Drive, S3, etc.\n- **Alternate Embeddings**: Use Cohere, Hugging Face, or custom models\n- **Custom Prompts**: Tweak the system and agent prompts to your domain\n- **Additional Tools**: Add more PostgresTool or external API nodes for richer capabilities\n\n---\n\n## Logging with Loki\nThis workflow emits structured logs to a Loki logging backend at key stages using dedicated Loki nodes:\n\n- **Loki1**: Logs inbound Box webhook events (e.g., file uploaded, deleted)\n- **Loki**: Logs cleanup actions like deleting old document rows and schema updates\n- **Loki2**: Logs post-embedding operations (e.g., embedding creation, vector insert confirmations)\n\nEach Loki node is configured with:\n- **URL**: `http://92.113.147.90:3100`\n- **Labels**: `{ app: \"rag-observer\" }`\n- **Log Pairs** include a timestamp and contextual message field\n\nUse the Loki UI to monitor workflow executions, audit document ingestion, and troubleshoot errors in real time.\n\n---\n\n## Troubleshooting\n- **Embeddings Errors**: Verify OpenAI credentials and rate limits\n- **pgvector Issues**: Ensure `CREATE EXTENSION IF NOT EXISTS vector;` ran successfully\n- **Supabase Connectivity**: Confirm API key and CORS configuration\n- **Chat Webhook Fails**: Check webhook URL, authentication, and response node settings\n\n*Happy automating!*",
        "height": 1960,
        "width": 540,
        "color": 6
      },
      "type": "n8n-nodes-base.stickyNote",
      "position": [
        -2340,
        0
      ],
      "typeVersion": 1,
      "id": "c9f500ca-3d31-49e2-9860-5fee38849f6e",
      "name": "Sticky Note9"
    },
    {
      "parameters": {
        "rules": {
          "values": [
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 2
                },
                "conditions": [
                  {
                    "leftValue": "={{ $json.body.trigger }}",
                    "rightValue": "FILE.UPLOADED",
                    "operator": {
                      "type": "string",
                      "operation": "equals"
                    },
                    "id": "9e06b976-d44c-46d0-85ac-fa468bd7b256"
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "File Created"
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 2
                },
                "conditions": [
                  {
                    "id": "89cab93a-66fb-472e-bbac-6a58aecbcece",
                    "leftValue": "={{ $json.body.trigger }}",
                    "rightValue": "FILE.DELETED",
                    "operator": {
                      "type": "string",
                      "operation": "equals",
                      "name": "filter.operator.equals"
                    }
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "File Deteted"
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 2
                },
                "conditions": [
                  {
                    "id": "6530b4e6-be5d-4ece-8faa-505e823bd542",
                    "leftValue": "={{ $json.body.trigger }}",
                    "rightValue": "METADATA_INSTANCE.UPDATED",
                    "operator": {
                      "type": "string",
                      "operation": "equals",
                      "name": "filter.operator.equals"
                    }
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "File Updated"
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 2
                },
                "conditions": [
                  {
                    "id": "8b3b0da9-faaf-46ed-85a0-08404c6d4c71",
                    "leftValue": "={{ $json.body.trigger }}",
                    "rightValue": "FILE.TRASHED",
                    "operator": {
                      "type": "string",
                      "operation": "equals",
                      "name": "filter.operator.equals"
                    }
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "File Trashed"
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 2
                },
                "conditions": [
                  {
                    "id": "ecd95282-fb79-4661-8e62-a9d98c4be5ca",
                    "leftValue": "={{ $json.body.trigger }}",
                    "rightValue": "FILE.RENAMED",
                    "operator": {
                      "type": "string",
                      "operation": "equals",
                      "name": "filter.operator.equals"
                    }
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "Renamed"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.switch",
      "typeVersion": 3.2,
      "position": [
        -1600,
        760
      ],
      "id": "6c6864dc-2fd1-49ac-8e45-60983a1998e4",
      "name": "Check the Trigger"
    },
    {
      "parameters": {
        "operation": "download",
        "fileId": "={{ $('Set File ID').item.json.file_id }}"
      },
      "type": "n8n-nodes-base.box",
      "typeVersion": 1,
      "position": [
        -660,
        840
      ],
      "id": "ee0510a3-b1d2-4bae-b800-957406da22e6",
      "name": "Box",
      "credentials": {
        "boxOAuth2Api": {
          "id": "Kx9GV4DMBuKdw060",
          "name": "Box account"
        }
      }
    },
    {
      "parameters": {
        "operation": "get",
        "fileId": "={{ $json.body.source.id }}",
        "additionalFields": {
          "fields": "extension"
        }
      },
      "type": "n8n-nodes-base.box",
      "typeVersion": 1,
      "position": [
        -1460,
        540
      ],
      "id": "9dd7e48c-fa29-450b-9133-65858fa2dd37",
      "name": "Box1",
      "credentials": {
        "boxOAuth2Api": {
          "id": "Kx9GV4DMBuKdw060",
          "name": "Box account"
        }
      }
    },
    {
      "parameters": {
        "operation": "delete",
        "tableId": "documents",
        "filterType": "string",
        "filterString": "=metadata->>file_id=like.*{{ $json.file_id }}*"
      },
      "id": "52bef7ff-5e61-4e5c-b65b-fdb41f040252",
      "name": "Delete Old Doc Rows1",
      "type": "n8n-nodes-base.supabase",
      "typeVersion": 1,
      "position": [
        -1160,
        1020
      ],
      "alwaysOutputData": true,
      "credentials": {
        "supabaseApi": {
          "id": "A7mzjq3DccqVxRhE",
          "name": "Supabase account 3"
        }
      }
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "10646eae-ae46-4327-a4dc-9987c2d76173",
              "name": "file_id",
              "value": "={{ $json.body.source.id }}",
              "type": "string"
            },
            {
              "id": "77d782de-169d-4a46-8a8e-a3831c04d90f",
              "name": "file_title",
              "value": "={{ $('Check the Trigger').item.json.body.source.name }}",
              "type": "string"
            }
          ]
        },
        "options": {}
      },
      "id": "898f8df9-0b71-4bb5-91a1-88137fa4d5d4",
      "name": "Set fille Id  (Deleted)",
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        -1380,
        1020
      ]
    },
    {
      "parameters": {
        "operation": "delete",
        "tableId": "document_rows",
        "filters": {
          "conditions": [
            {
              "keyName": "dataset_id",
              "condition": "eq",
              "keyValue": "={{ $('Set fille Id  (Deleted)').item.json.file_id }}"
            }
          ]
        }
      },
      "type": "n8n-nodes-base.supabase",
      "typeVersion": 1,
      "position": [
        -960,
        1020
      ],
      "id": "24d918aa-c4f3-4876-8424-997a1cdc9f75",
      "name": "Delete Old Data Rows1",
      "alwaysOutputData": true,
      "executeOnce": true,
      "credentials": {
        "supabaseApi": {
          "id": "A7mzjq3DccqVxRhE",
          "name": "Supabase account 3"
        }
      }
    },
    {
      "parameters": {
        "httpMethod": "POST",
        "path": "3fe87bcc-ddb9-4719-97e2-fbedd6adb28d",
        "options": {}
      },
      "type": "n8n-nodes-base.webhook",
      "typeVersion": 2,
      "position": [
        -1660,
        1340
      ],
      "id": "037ccd93-27ab-4958-aff3-aa444de5d3b7",
      "name": "Watch File Change",
      "webhookId": "3fe87bcc-ddb9-4719-97e2-fbedd6adb28d"
    },
    {
      "parameters": {
        "url": "http://92.113.147.90:3100",
        "labelPairs": {
          "parameters": [
            {
              "label": "app",
              "value": "rag-observer"
            }
          ]
        },
        "logPairs": {
          "parameters": [
            {}
          ]
        }
      },
      "type": "n8n-nodes-loki.Loki",
      "typeVersion": 1,
      "position": [
        -760,
        1020
      ],
      "id": "e873e249-78e7-495b-ab2e-9f8dfa65e46f",
      "name": "Delete Log"
    },
    {
      "parameters": {
        "url": "http://92.113.147.90:3100",
        "labelPairs": {
          "parameters": [
            {
              "label": "app",
              "value": "rag-observer"
            }
          ]
        },
        "logPairs": {
          "parameters": [
            {
              "log": "=Workflow Triggred: {{ $json.body.source.id }}"
            }
          ]
        }
      },
      "type": "n8n-nodes-loki.Loki",
      "typeVersion": 1,
      "position": [
        -1620,
        1080
      ],
      "id": "41f3d7df-3db5-44b6-b6d7-42c3cc9d02d4",
      "name": "Start Log"
    },
    {
      "parameters": {
        "url": "http://92.113.147.90:3100",
        "labelPairs": {
          "parameters": [
            {
              "label": "app",
              "value": "rag-observer"
            }
          ]
        },
        "logPairs": {
          "parameters": [
            {
              "log": "=Embedding created for file: "
            }
          ]
        }
      },
      "type": "n8n-nodes-loki.Loki",
      "typeVersion": 1,
      "position": [
        1260,
        840
      ],
      "id": "795e173a-b902-4e3d-8f07-2642e9157432",
      "name": "End Log"
    },
    {
      "parameters": {
        "resource": "audio",
        "operation": "transcribe",
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.openAi",
      "typeVersion": 1.8,
      "position": [
        -320,
        1260
      ],
      "id": "62cb39d2-827d-4430-a31e-69daae8cb44c",
      "name": "OpenAI",
      "credentials": {
        "openAiApi": {
          "id": "TUNbbZhFy4QjUJm0",
          "name": "New Open ai "
        }
      }
    },
    {
      "parameters": {
        "authentication": "oAuth2",
        "select": "channel",
        "channelId": {
          "__rl": true,
          "value": "C08QC7ZR8KD",
          "mode": "list",
          "cachedResultName": "box-rag"
        },
        "text": "={{$json.text}}",
        "otherOptions": {}
      },
      "type": "n8n-nodes-base.slack",
      "typeVersion": 2.3,
      "position": [
        -140,
        1260
      ],
      "id": "31f06535-da5a-4f9e-953a-59ce77b44e36",
      "name": "Slack",
      "webhookId": "c127621d-afd2-41d7-a61b-1809d61a9a48",
      "credentials": {
        "slackOAuth2Api": {
          "id": "vcv6r674EVNMorsX",
          "name": "Slack account"
        }
      }
    }
  ],
  "connections": {
    "OpenAI Chat Model": {
      "ai_languageModel": [
        [
          {
            "node": "RAG AI Agent",
            "type": "ai_languageModel",
            "index": 0
          }
        ]
      ]
    },
    "Default Data Loader": {
      "ai_document": [
        [
          {
            "node": "Insert into Supabase Vectorstore",
            "type": "ai_document",
            "index": 0
          }
        ]
      ]
    },
    "Embeddings OpenAI1": {
      "ai_embedding": [
        [
          {
            "node": "Insert into Supabase Vectorstore",
            "type": "ai_embedding",
            "index": 0
          }
        ]
      ]
    },
    "Extract Document Text": {
      "main": [
        [
          {
            "node": "Insert into Supabase Vectorstore",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Postgres Chat Memory": {
      "ai_memory": [
        [
          {
            "node": "RAG AI Agent",
            "type": "ai_memory",
            "index": 0
          }
        ]
      ]
    },
    "Delete Old Doc Rows": {
      "main": [
        [
          {
            "node": "Delete Old Data Rows",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Set File ID": {
      "main": [
        [
          {
            "node": "Delete Old Doc Rows",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Edit Fields": {
      "main": [
        [
          {
            "node": "RAG AI Agent",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "When chat message received": {
      "main": [
        [
          {
            "node": "Edit Fields",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Webhook": {
      "main": [
        [
          {
            "node": "Edit Fields",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Extract PDF Text": {
      "main": [
        [
          {
            "node": "Insert into Supabase Vectorstore",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Aggregate": {
      "main": [
        [
          {
            "node": "Summarize",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Character Text Splitter": {
      "ai_textSplitter": [
        [
          {
            "node": "Default Data Loader",
            "type": "ai_textSplitter",
            "index": 0
          }
        ]
      ]
    },
    "Summarize": {
      "main": [
        [
          {
            "node": "Set Schema",
            "type": "main",
            "index": 0
          },
          {
            "node": "Insert into Supabase Vectorstore",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "RAG AI Agent": {
      "main": [
        [
          {
            "node": "Respond to Webhook",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Switch": {
      "main": [
        [
          {
            "node": "Extract PDF Text",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Extract from Excel",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Extract from CSV",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Extract Document Text",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "OpenAI",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Extract from Excel": {
      "main": [
        [
          {
            "node": "Aggregate",
            "type": "main",
            "index": 0
          },
          {
            "node": "Insert Table Rows",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Set Schema": {
      "main": [
        [
          {
            "node": "Update Schema for Document Metadata",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Extract from CSV": {
      "main": [
        [
          {
            "node": "Aggregate",
            "type": "main",
            "index": 0
          },
          {
            "node": "Insert Table Rows",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Create Document Metadata Table": {
      "main": [
        [
          {
            "node": "Create Document Rows Table (for Tabular Data)",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "List Documents": {
      "ai_tool": [
        [
          {
            "node": "RAG AI Agent",
            "type": "ai_tool",
            "index": 0
          }
        ]
      ]
    },
    "Get File Contents": {
      "ai_tool": [
        [
          {
            "node": "RAG AI Agent",
            "type": "ai_tool",
            "index": 0
          }
        ]
      ]
    },
    "Query Document Rows": {
      "ai_tool": [
        [
          {
            "node": "RAG AI Agent",
            "type": "ai_tool",
            "index": 0
          }
        ]
      ]
    },
    "Supabase Vector Store1": {
      "ai_tool": [
        [
          {
            "node": "RAG AI Agent",
            "type": "ai_tool",
            "index": 0
          }
        ]
      ]
    },
    "Embeddings OpenAI2": {
      "ai_embedding": [
        [
          {
            "node": "Supabase Vector Store1",
            "type": "ai_embedding",
            "index": 0
          }
        ]
      ]
    },
    "Create Documents Table and Match Function": {
      "main": [
        [
          {
            "node": "Create Document Metadata Table",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Delete Old Data Rows": {
      "main": [
        [
          {
            "node": "Insert Document Metadata",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Insert Document Metadata": {
      "main": [
        [
          {
            "node": "Box",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Check the Trigger": {
      "main": [
        [
          {
            "node": "Box1",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Set fille Id  (Deleted)",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Box1",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Set fille Id  (Deleted)",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Box1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Box": {
      "main": [
        [
          {
            "node": "Switch",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Box1": {
      "main": [
        [
          {
            "node": "Set File ID",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Set fille Id  (Deleted)": {
      "main": [
        [
          {
            "node": "Delete Old Doc Rows1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Delete Old Doc Rows1": {
      "main": [
        [
          {
            "node": "Delete Old Data Rows1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Insert into Supabase Vectorstore": {
      "main": [
        [
          {
            "node": "End Log",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Delete Old Data Rows1": {
      "main": [
        [
          {
            "node": "Delete Log",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Watch File Change": {
      "main": [
        [
          {
            "node": "Start Log",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Start Log": {
      "main": [
        [
          {
            "node": "Check the Trigger",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "OpenAI": {
      "main": [
        [
          {
            "node": "Slack",
            "type": "main",
            "index": 0
          }
        ]
      ]
    }
  },
  "settings": {
    "executionOrder": "v1",
    "callerPolicy": "workflowsFromSameOwner",
    "errorWorkflow": "g8oVhs1GlKPeruvm"
  },
  "staticData": null,
  "meta": {
    "templateCredsSetupCompleted": true
  },
  "pinData": {},
  "versionId": "55dfbe14-dbd5-4d60-a968-dd29577818ef",
  "triggerCount": 2,
  "tags": [],
  "shared": [
    {
      "createdAt": "2025-04-29T21:03:29.152Z",
      "updatedAt": "2025-04-29T21:03:29.152Z",
      "role": "workflow:owner",
      "workflowId": "6DlTcVhwMXJNH5D2",
      "projectId": "IQ4w3zW02fJzIdTt",
      "project": {
        "createdAt": "2025-01-25T02:11:56.995Z",
        "updatedAt": "2025-01-25T21:11:21.957Z",
        "id": "IQ4w3zW02fJzIdTt",
        "name": "Yonatan Tesfaye <yonatantesfaye30@gmail.com>",
        "type": "personal",
        "icon": null,
        "description": null
      }
    }
  ]
}